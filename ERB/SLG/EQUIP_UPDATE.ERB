;---------------------------
; 装備更新
;---------------------------

;---------------------------
; 主砲更新
;---------------------------
@EQUIP_UPDATE_0(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3, 4, 5, 11, 12, 13, 14, 21, 22, 23
#DIM CONST AIR_EQUIP_IDS = 101, 102, 103
IF SHIP_TYPE:SHIP_ID == 偵察艇 || SHIP_TYPE:SHIP_ID == 輸送船 || SHIP_TYPE:SHIP_ID == 作業船
	PRINTW この艦種は主砲を装備できません
	RETURN
ENDIF
$INPUT_LOOP
IF SHIP_TYPE:SHIP_ID != 空母
	PRINTFORML      装備名                               ダメージ  射撃レート 命中率  有効距離  サイズ
	DRAWLINE
	FOR ITER, 0, VARSIZE("EQUIP_IDS")
		CALL GET_MAIN_WEAPON(EQUIP_IDS:ITER)
		SIF SHIP_MAIN_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
			CONTINUE
		PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {DAMAGE, 4, RIGHT}\t{FIRE_RATE, 2, RIGHT}\t{HIT_RATE, 3, RIGHT}\t{FIRE_RANGE}\t{SIZE}", EQUIP_IDS:ITER
		PRINTL 
	NEXT
	PRINTBUTTON "[戻る]", 999
	INPUT
	SIF RESULT == 999
		RETURN
	SELECTED = RESULT
	FINDELEMENT EQUIP_IDS, RESULT
	IF RESULT == -1
		GOTO INPUT_LOOP
	ELSE
		CALL GET_MAIN_WEAPON(SELECTED)
		SIF SHIP_MAIN_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
			GOTO INPUT_LOOP
		CALL GET_MAIN_WEAPON_DESCRIPTION(SELECTED)
		CALL CHECK_BUY
		IF RESULT == 1
			SHIP_EQUIP:主砲:SHIP_ID = SELECTED
		ELSE
			GOTO INPUT_LOOP
		ENDIF
	ENDIF
ELSE
	PRINTFORML      装備名                            対艦攻撃力  射撃レート  命中率  有効距離  耐久  サイズ
	DRAWLINE
	FOR ITER, 0, VARSIZE("AIR_EQUIP_IDS")
		CALL GET_MAIN_WEAPON(AIR_EQUIP_IDS:ITER)
		SIF SHIP_MAIN_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
			CONTINUE
		PRINTBUTTON @"[{AIR_EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {AIR_SHIP_POWER, 3, RIGHT}\t{FIRE_RATE, 3, RIGHT}\t{HIT_RATE, 3, RIGHT}\t{FIRE_RANGE}\t{AIR_SHIP_HP, 4, RIGHT}\t{SIZE}", AIR_EQUIP_IDS:ITER
		PRINTL 
	NEXT
	PRINTBUTTON "[戻る]", 999
	INPUT
	SIF RESULT == 999
		RETURN
	SELECTED = RESULT
	FINDELEMENT AIR_EQUIP_IDS, RESULT
	IF RESULT == -1
		GOTO INPUT_LOOP
	ELSE
		CALL GET_MAIN_WEAPON(SELECTED)
		SIF SHIP_MAIN_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
			GOTO INPUT_LOOP
		CALL GET_MAIN_WEAPON_DESCRIPTION(SELECTED)
		CALL CHECK_BUY
		IF RESULT == 1
			SHIP_EQUIP:主砲:SHIP_ID = SELECTED
		ELSE
			GOTO INPUT_LOOP
		ENDIF
	ENDIF
ENDIF



;---------------------------
; 副砲更新
;---------------------------
@EQUIP_UPDATE_1(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3, 4
IF SHIP_TYPE:SHIP_ID == 偵察艇 || SHIP_TYPE:SHIP_ID == 輸送船 || SHIP_TYPE:SHIP_ID == 作業船
	PRINTW この艦種は副砲を装備できません
	RETURN
ENDIF
$INPUT_LOOP
PRINTFORML      装備名                               ダメージ  射撃レート 対空 命中率  有効距離  サイズ
DRAWLINE
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_SUB_WEAPON(EQUIP_IDS:ITER)
	SIF SHIP_SUB_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		CONTINUE
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {DAMAGE, 4, RIGHT}\t{FIRE_RATE, 2, RIGHT}\t{HIT_RATE, 3, RIGHT}\t{ANTI_AIR, 3, RIGHT}\t{FIRE_RANGE}\t{SIZE}", EQUIP_IDS:ITER
	PRINTL 
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_SUB_WEAPON(SELECTED)
	SIF SHIP_SUB_WEAPON_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		GOTO INPUT_LOOP
	CALL GET_SUB_WEAPON_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:副砲:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; シールド更新
;---------------------------
@EQUIP_UPDATE_2(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3, 4, 5, 6, 7, 8, 9
$INPUT_LOOP
PRINTFORML      装備名                               シールド値  シールド自動回復値  サイズ
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_SIELD(EQUIP_IDS:ITER)
	SIF SHIP_SIELD_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		CONTINUE
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {SIELD, 4, RIGHT}\t{SIELD_RECOVER, 2, RIGHT}\t{SIZE}", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_SIELD(SELECTED)
	PRINTFORML {SHIP_SIELD_SIZE:(SHIP_TYPE:SHIP_ID)} < size: {SIZE}
	SIF SHIP_SIELD_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		GOTO INPUT_LOOP
	CALL GET_SIELD_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:シールド:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; 装甲更新
;---------------------------
@EQUIP_UPDATE_3(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3
$INPUT_LOOP
PRINTFORML      装備名                                  装甲  サイズ
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_ARMOR(EQUIP_IDS:ITER)
	SIF SHIP_ARMOR_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		CONTINUE
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {ARMOR, 4, RIGHT}\t{SIZE}", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_ARMOR(SELECTED)
	SIF SHIP_ARMOR_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		GOTO INPUT_LOOP
	CALL GET_ARMOR_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:装甲:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; エンジン更新
;---------------------------
@EQUIP_UPDATE_4(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
$INPUT_LOOP
PRINTFORML      装備名                               スピード  回避  サイズ
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_ENGIN(EQUIP_IDS:ITER)
	SIF SHIP_ENGIN_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		CONTINUE
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {SPEED}\t{AVOID, 3, RIGHT}\t{SIZE}", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_ENGIN(SELECTED)
	SIF SHIP_ENGIN_SIZE:(SHIP_TYPE:SHIP_ID) < SIZE
		GOTO INPUT_LOOP
	CALL GET_ENGIN_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:エンジン:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; AI更新
;---------------------------
@EQUIP_UPDATE_5(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1
$INPUT_LOOP
PRINTFORML      装備名
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_COMPUTER(EQUIP_IDS:ITER)
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT%", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_COMPUTER_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:AI:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; センサー更新
;---------------------------
@EQUIP_UPDATE_6(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1, 2, 3
$INPUT_LOOP
PRINTFORML      装備名                               センサー範囲
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_SENSOR(EQUIP_IDS:ITER)
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT% {SENSOR}", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_SENSOR_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:センサー:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF
;---------------------------
; オプション更新
;---------------------------
@EQUIP_UPDATE_7(SHIP_ID)
#DIM SHIP_ID
#DIM ITER
#DIM SELECTED
#DIM CONST EQUIP_IDS = 1
$INPUT_LOOP
PRINTFORML      装備名
FOR ITER, 0, VARSIZE("EQUIP_IDS")
	CALL GET_OPTION(EQUIP_IDS:ITER)
	PRINTBUTTON @"[{EQUIP_IDS:ITER, 3, RIGHT}] %EQUIP_NAME, 40, LEFT%", EQUIP_IDS:ITER
	PRINTL
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
FINDELEMENT EQUIP_IDS, RESULT
IF RESULT == -1
	GOTO INPUT_LOOP
ELSE
	CALL GET_OPTION_DESCRIPTION(SELECTED)
	CALL CHECK_BUY
	IF RESULT == 1
		SHIP_EQUIP:オプション:SHIP_ID = SELECTED
	ELSE
		GOTO INPUT_LOOP
	ENDIF
ENDIF

;---------------------------
; 購入確認
;---------------------------
@CHECK_BUY
DRAWLINE
$INPUT_LOOP
PRINTL 購入しますか？
PRINTBUTTON "[0] 購入", 0
PRINT  
PRINTBUTTON "[1] 戻る", 1
PRINTL
INPUT
IF RESULT == 0
	RETURN 1
ELSEIF RESULT == 1
	RETURN 0
ELSE
	CLEARLINE 3
	GOTO INPUT_LOOP
ENDIF
