;---------------------------
; 地下闘技場
;---------------------------
@UNDER_GROUND_BATTLE_FIELD

$INPUT_LOOP
SETCOLOR 0X666666
CUSTOMDRAWLINE ///
RESETCOLOR
PRINTFORML 地下闘技場 現在のランク: %UNDER_GRAUND_RANK()%
SETCOLOR 0X666666
CUSTOMDRAWLINE ///
RESETCOLOR
PRINTBUTTON "[闘う]", 0
PRINTL
PRINTBUTTON "[帰る]", 1
INPUT
IF RESULT == 0
  CALL BATTLE_THE_UNDER_GRAUND
ELSEIF RESULT == 1
  RETURN
ENDIF
GOTO INPUT_LOOP

@UNDER_GRAUND_RANK
#FUNCTIONS

IF BATTLE_POINT < 100
  RETURNF "E"
ELSEIF BATTLE_POINT < 1000
  RETURNF "D"
ELSEIF BATTLE_POINT < 10000
  RETURNF "C"
ELSEIF BATTLE_POINT < 20000
  RETURNF "B"
ELSEIF BATTLE_POINT < 50000
  RETURNF "A"
ELSEIF BATTLE_POINT < 100000
  RETURNF "S"
ELSEIF BATTLE_POINT < 500000
  RETURNF "SS"
ELSE
  RETURNF "SSS"
ENDIF

@BATTLE_THE_UNDER_GRAUND
IF BATTLE_POINT < 100
  CALL RANK_E_BATTLE
ELSEIF BATTLE_POINT < 1000
  CALL RANK_D_BATTLE
ELSEIF BATTLE_POINT < 10000
  CALL RANK_C_BATTLE
ELSEIF BATTLE_POINT < 20000
  CALL RANK_B_BATTLE
ELSEIF BATTLE_POINT < 50000
  CALL RANK_A_BATTLE
ELSEIF BATTLE_POINT < 100000
  CALL RANK_S_BATTLE
ELSEIF BATTLE_POINT < 500000
  CALL RANK_SS_BATTLE
ELSE
  CALL RANK_SSS_BATTLE
ENDIF

@RANK_E_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(1000, 1200)
SELECTCASE RAND:10
  CASE 0
    LOCALS = ちんぴら
  CASE 1
    LOCALS = 格闘マニア
  CASE 2
    LOCALS = 借金まみれ
  CASE 3
    LOCALS = 暇な主婦
  CASE 4
    LOCALS = 廃棄寸前の愛玩戦車
  CASE 5
    LOCALS = 老兵
  CASE 6
    LOCALS = 新兵
  CASE 7
    LOCALS = 科学マニア
  CASE 8
    LOCALS = 観光客
  CASE 9
    LOCALS = 大学生
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「や、やってやる！」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(20, 40))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(5)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(5, 10)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(500, 1000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(1, 5), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_D_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(1100, 1300)
SELECTCASE RAND:5
  CASE 0
    LOCALS = ちんぴら
  CASE 1
    LOCALS = 格闘マニア
  CASE 2
    LOCALS = 武術家
  CASE 3
    LOCALS = 格闘家
  CASE 4
    LOCALS = ロボット
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「いくぞ！」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(30, 50))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(8)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(40, 60)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(2000, 4000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(10, 20), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_C_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(1500, 1800)
SELECTCASE RAND:4
  CASE 0
    LOCALS = 極道
  CASE 1
    LOCALS = 格闘家
  CASE 2
    LOCALS = 武術家
  CASE 3
    LOCALS = サイボーグ
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「……敵に不足なし！」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(40, 55))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(12)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(400, 600)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(20000, 40000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(100, 200), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_B_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(2000, 2500)
SELECTCASE RAND:4
  CASE 0
    LOCALS = 傭兵
  CASE 1
    LOCALS = 熟練兵
  CASE 2
    LOCALS = 師範代
  CASE 3
    LOCALS = サイボーグ
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「ゆくぞ！」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(55, 70))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(16)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(400, 800)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(40000, 80000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(200, 400), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_A_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(2500, 3000)
SELECTCASE RAND:4
  CASE 0
    LOCALS = 性豪
  CASE 1
    LOCALS = 特殊部隊員
  CASE 2
    LOCALS = 達人格闘家
  CASE 3
    LOCALS = 戦闘サイボーグ
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「俺に勝てるかな？」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(70, 90))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(20)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(4090, 8000)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(400000, 800000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(2000, 4000), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_S_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(3000, 3500)
SELECTCASE RAND:4
  CASE 0
    LOCALS = 格闘王
  CASE 1
    LOCALS = 特殊部隊員
  CASE 2
    LOCALS = 肩メロン
  CASE 3
    LOCALS = 戦闘サイボーグ
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「言葉はいらぬ」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(90, 110))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
CALL CC_ADD_COMBAT_EXP(30)
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(6000, 12000)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(800000, 1600000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(4000, 8000), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_SS_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = RAND(4000, 5000)
SELECTCASE RAND:3
  CASE 0
    LOCALS = 元チャンピョン
  CASE 1
    LOCALS = メック
  CASE 2
    LOCALS = 地上最強の男
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「……」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, RAND(110, 130))
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
IF ABL:MASTER:白兵 == 300 && MAXBASE:MASTER:体力 < 7500
  MAXBASE:MASTER:体力 += 1
ELSE
  CALL CC_ADD_COMBAT_EXP(60)
ENDIF
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(30000, 60000)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(8000000, 16000000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - RAND(8000, 12000), 0, 99999999)
  PRINTFORMW バトルポイントを失った
ENDIF

@RANK_SSS_BATTLE
#DIM JUDGE
;白兵戦参加メンバーの初期化
CALL CC_INIT_MEMBER()
;攻撃側キャラクターの設定(最大6名)
CALL CC_ADDCHARA("ATTACKER", MASTER)
;防御側キャラクターの設定(最大6名)
LOCAL = 7500
SELECTCASE RAND:1
  CASE 0
    LOCALS = 宇宙最強の男
ENDSELECT
PRINTFORML 歓声に包まれる中、%CALLNAME:MASTER%と対戦相手の%LOCALS%が舞台に入った
PRINTFORMW %LOCALS%「まさかあの時の奴がここまでくるとはな……いくぞ！」
PRINTL
PRINTFORMW 戦闘開始！
CALL CC_ADDMOB("DEFENDER", LOCALS, LOCAL, LOCAL, 300)
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
JUDGE = RESULT
IF ABL:MASTER:白兵 == 300 && MAXBASE:MASTER:体力 < 7500
  MAXBASE:MASTER:体力 += 5
ELSE
  CALL CC_ADD_COMBAT_EXP(300)
ENDIF
IF JUDGE == 1
  PRINTFORMW 勝者、%CALLNAME:MASTER%!
  BATTLE_POINT += RAND(240000, 480000)
  PRINTFORMW バトルポイントを手に入れた
  LOCAL = RAND(80000000, 160000000)
  PRINTFORMW 賞金%TOSTR(LOCAL, "$###,###")%手に入れた
  MONEY += LOCAL
  PRINTFORMW 「はは、はははは、ついに現れた！俺の退屈を紛らわせてくれる奴が！」
  QUEST_PROGRESS:87 = 8
ELSE
  PRINTFORMW 勝者、%LOCALS%!
  BATTLE_POINT = LIMIT(BATTLE_POINT - 400000, 0, 99999999)
  PRINTFORMW バトルポイントを失った
  PRINTFORMW 「やはり俺の退屈を埋めてくれる奴はいないのか……」
ENDIF