;※宙域画面は特殊なメニューでメニューボタンの表示位置を固定している
;　番号を変える場合は@COLUMN_LEFT_MENU_SHOW を確認する必要あり
;-------------------------------------------------
;「宙域」の名称
;-------------------------------------------------
@SHOP_LIFE_NAME83
RESULTS:0 '= "周回"

;-------------------------------------------------
;「宙域画面」の選択可否
;-------------------------------------------------
@SHOP_LIFE_CHECK83
SIF CFLAG:MASTER:捕虜先
	RETURN 0
RETURN 1

;-------------------------------------------------
;「宙域画面」の左カラムメニューの入力処理
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY83

LINES_SHOP = LINECOUNT

CALL CHOICE_CLONE_CHARACTER
SIF !RESULT
	RETURN
CALL DELETE_NPC_SHIP
CALL INIT_COUNTRY_DATA
CALL INIT_4X_SLG_SAVEDATA

IS_NEWGAME = 1
CALL NEWLOOP(IS_NEWGAME)
CALL GAME_INIT
CALL SLG_INIT(RESULT)

;-------------------------------------------------
; 引き継ぎキャラクターの選択
;-------------------------------------------------
@CHOICE_CLONE_CHARACTER
#DIM INPUT_VALUE
CALL ARRANGEMENT_NO
$INPUT_LOOP
CUSTOMDRAWLINE =
PRINTL 引き継ぐキャラを選択してください
PRINTL [こちらの機能は動作保証をしておりません]
PRINTL [周回後のエラーに関してはご容赦ください]
CUSTOMDRAWLINE =
PRINTL

FOR LOCAL, 1, CHARANUM
	SIF CFLAG:LOCAL:所属 != CFLAG:MASTER:所属
		CONTINUE
	IF CFLAG:LOCAL:引き継ぎキャラ
		LOCALS = ○
	ELSE
		LOCALS = ×
	ENDIF
	PRINTBUTTONC @"[%LOCALS%] - [{LOCAL}]%CALLNAME:LOCAL, 32, LEFT%", LOCAL
NEXT
PRINTL
PRINTL
SETCOLOR 0X999999
DRAWLINE
RESETCOLOR
LOCALS = [999] 決定
PRINTBUTTON @"%LOCALS, 24, LEFT%", 999
PRINTBUTTON "[1000] キャンセル", 1000
PRINTL
DRAWLINE
INPUT
INPUT_VALUE = RESULT
IF INPUT_VALUE == 999
	CALL DELETE_CHARA_FROM_LIST
	CFLAG:MASTER:引き継ぎキャラ = 1
	RETURN 1
ELSEIF INPUT_VALUE == 1000
	RETURN 0
ELSEIF INPUT_VALUE > CHARANUM
	GOTO INPUT_LOOP
ELSEIF NAME:INPUT_VALUE != "" && CFLAG:INPUT_VALUE:所属 == CFLAG:MASTER:所属
	ABS (CFLAG:INPUT_VALUE:引き継ぎキャラ - 1)
	CFLAG:INPUT_VALUE:引き継ぎキャラ = RESULT:0
ENDIF
GOTO INPUT_LOOP

;-------------------------------------------------
; キャラ削除
;-------------------------------------------------
@DELETE_CHARA_FROM_LIST()
#DIM _TAG_ID
SIF CHARANUM > 1
	FINDCHARA CFLAG:45, 0, 1, CHARANUM
IF CHARANUM == 1 || RESULT == -1
	FOR LOCAL, 1, MIN_NO_RANDOM_CHARA,
		EXISTCSV LOCAL
		SIF RESULT == 0
			CONTINUE
		ADDCHARA LOCAL
		TRYCALLFORM CLOTH_INIT_{LOCAL}
		CALL INIT_NEWCHARA(CHARANUM - 1)
	NEXT
	RETURN
ENDIF
CALL DELETE_CHARA(RESULT)
RESTART

;-------------------------------------------------
; 艦船の待避
;-------------------------------------------------
@DELETE_NPC_SHIP
#DIM SHIP_ID
#DIM EQUIP_TYPE_ID
#DIM SLOT_ID
#DIM SHIP_MODEL_ID
#DIM ITER

ITER = 0

FOR SHIP_ID, 0, MAX_SHIP
	SIF SHIP_COUNTRY:SHIP_ID == 0
		CONTINUE
	SIF SHIP_COUNTRY:SHIP_ID != 国家ID_プレイヤー
		CALL DELETE_SHIP(SHIP_ID)
NEXT


;-------------------------------------------------
; 国のデータ初期化
;-------------------------------------------------
@INIT_COUNTRY_DATA
#DIM COUNTRY_ID
#DIM QUEST_ID

;嫌われている場合は初期値まで戻す。それ以外は好感度引継ぎ
FOR COUNTRY_ID, 0, MAX_COUNTRY
	SIF REL_LIKE_COUNTRY:COUNTRY_ID:国家ID_プレイヤー < 0
		REL_LIKE_COUNTRY:COUNTRY_ID:国家ID_プレイヤー = 0
NEXT


;-------------------------------------------------
; 変数初期化
;-------------------------------------------------
@INIT_4X_SLG_SAVEDATA


VARSET BOARDING_SHIP_ID, 0
VARSET RIDING_WITH, 0
VARSET CHARACTER_POSITION, 0
VARSET MASTER_LEFT_DAY, 0
VARSET MAP, 0
VARSET CLEARMAP, 0
VARSET RESOURCE_MAP, 0
VARSET STAR_OWNER, 0
VARSET PORT_POSITION_ID, 0
VARSET PORT_OWNER, 0
FILTER_SHIP_CATEGORY = 0
FILTER_SHIP_MISSION = 0
SORT_SHIP_MISSION = 0
VARSET TRADE_ITEM, 0
VARSET SHIP_EQUIP_TEMPLATE, 0
VARSET COUNTRY_NAME, ""
VARSET MEETING_POINT, 0
VARSET WAR_PHASE, 0
VARSET WAR_TARGET_POS, 0
VARSET INVASION_ARMY, 0
VARSET 自然生成海賊合流POSID, 0
VARSET MINING_ID, 0
VARSET MINING_POINT, 0
;VARSET HUMAN_LAB, 0
VARSET SLG_ITEM, 0
VARSET ITEM_PRICE, 0
VARSET SHOP_ITEMS, 0
VARSET AUTO_SALE, 0
VARSET IS_SALE, 0
VARSET SALE_TARGET, 0
VARSET ITEM_NUM_BORDER, 0
VARSET SHOP_IN_CHARGE, 0
VARSET STAR_PORT_SLOT, 0
VARSET STAR_PORT_CARGO, 0
VARSET PORT_SLOT, 0
VARSET STAR_PORT_CARGO, 0
VARSET PORT_SLOT, 0
VARSET PORT_CARGO, 0
VARSET PORT_RESOURCE, 0
VARSET PORT_COMPLETE, 0
VARSET RESOURCE_RESEARCH_TARGET_FROM_STAR, 0
VARSET RESOURCE_RESEARCH_TARGET_FROM_PORT, 0
VARSET RESOURCE_RESEARCH_DATE_FROM_STAR, 0
VARSET RESOURCE_RESEARCH_DATE_FROM_PORT, 0
VARSET BUILDUP_TARGET_STAR_ID, 0

VARSET PORT_POSITION_ID, 0
VARSET PORT_OWNER, 0
VARSET QUEST_PROGRESS, 0
VARSET QUESTMAP, 0
VARSET QUEST_COMPLETE_DATE, 0
VARSET QUEST_05_FLAG, 0
マップ掃除フラグ = 0
VARSET RENTAL_SHIP, 0
レジスタンスアジト = 0
QUEST_61_受注星 = 0
QUEST_63_都市記録Ａ = 0
QUEST_63_都市記録Ｂ = 0
QUEST_63_途絶都市 = 0
ANONYM_SECTOR = 0
ANONYM_X_POS = 0
ANONYM_Y_POS = 0
QUEST_97_旧文明の軍事要塞 = 0
VARSET ANOMALY_MAP, 0
VARSET ANOMALY_PROGRESS, 0
VARSET ANOMALY_POSITIONID, 0
VARSET UNIT_ID, 0
VARSET PMC_QUEST_PROGRESS, 0
PMC_INITED = 0
SPAWN_ZOMBIE = 0
CAPTURE_DOCTOR = 0

R支持率 = 0
R戦車 = 0
R航空機 = 0
R充足 = 0
R戦闘員 = 0
R非戦闘員 = 0
R研究者 = 0
R_CURRENT_RESEARCH = 0
R_RESEARCH_DATE = 0
R_SCHOOL = 0
VARSET R_SECRET_FACTORY, 0
R_SPY = 0
VARSET R_SUPERVISER, 0
VARSET R_SUPERVISER_IS, 0
VARSET R_SUPERVISER_COST, 0
R_SUPERVISER_COST = 0
R_FIELD_HOSPITAL = 0
R_MILITARY_ADVISER = 0
内偵効率 = 0
内偵進捗 = 0

;-------------------------------------------------
;「宙域画面」の右カラムオフ判定
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY_COLUMN_RIGHT_OFF_CHECK83

