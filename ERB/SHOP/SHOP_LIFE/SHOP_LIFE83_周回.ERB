;※宙域画面は特殊なメニューでメニューボタンの表示位置を固定している
;　番号を変える場合は@COLUMN_LEFT_MENU_SHOW を確認する必要あり
;-------------------------------------------------
;「宙域」の名称
;-------------------------------------------------
@SHOP_LIFE_NAME83
RESULTS:0 '= "周回"

;-------------------------------------------------
;「宙域画面」の選択可否
;-------------------------------------------------
@SHOP_LIFE_CHECK83
SIF CFLAG:MASTER:捕虜先
	RETURN 0
RETURN 1

;-------------------------------------------------
;「宙域画面」の左カラムメニューの入力処理
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY83

VARSET SELECT_LIST, 0
LINES_SHOP = LINECOUNT

CALL CHOICE_CLONE_CHARACTER
SIF !RESULT
	RETURN
CALL CLONE_PLAYER_SHIP
CALL INIT_COUNTRY_DATA

IS_NEWGAME = 1
CALL NEWLOOP(IS_NEWGAME)
CALL GAME_INIT
CALL SLG_INIT(RESULT)

;-------------------------------------------------
; 引き継ぎキャラクターの選択
;-------------------------------------------------
@CHOICE_CLONE_CHARACTER
#DIM ITER = 0

$INPUT_LOOP

DRAWLINE
PRINTL
PRINTL 引き継ぐキャラを選択してください
PRINTL
DRAWLINE
PRINTL

ITER = 0
FOR LOCAL, 1, CHARANUM
	SIF CFLAG:LOCAL:所属 != CFLAG:MASTER:所属
		CONTINUE
	IF SELECT_LIST:LOCAL
		LOCALS = ○
	ELSE
		LOCALS = ×
	ENDIF
	PRINTBUTTON @"[%LOCALS%] - [{LOCAL}]%CALLNAME:LOCAL, 32, LEFT%", LOCAL
	SIF ITER % 2
		PRINTL
	ITER ++
NEXT
PRINTL
LOCALS = [999] 決定
PRINTBUTTON @"%LOCALS, 24, LEFT%", 999
PRINTBUTTON "[1000] キャンセル", 1000
PRINTL

INPUT
IF RESULT == 999
	RETURN 1
ELSEIF RESULT == 1000
	RETURN 0
ELSEIF RESULT > CHARANUM
	GOTO INPUT_LOOP
ELSEIF NAME:RESULT != "" && CFLAG:RESULT:所属 == CFLAG:MASTER:所属
	INVERTBIT SELECT_LIST:RESULT, 0
ENDIF
GOTO INPUT_LOOP
;-------------------------------------------------
; 艦船の待避
;-------------------------------------------------
@CLONE_PLAYER_SHIP
#DIM SHIP_ID
#DIM EQUIP_TYPE_ID
#DIM SLOT_ID
#DIM SHIP_MODEL_ID
#DIM ITER

ITER = 0

FOR SHIP_ID, 0, MAX_SHIP
	SIF SHIP_NAME:SHIP_ID == ""
		CONTINUE
	SIF SHIP_COUNTRY:SHIP_ID != 国家ID_プレイヤー
		CONTINUE
	__SHIP_CATEGORY:ITER = SHIP_CATEGORY:SHIP_ID
	__SHIP_NAME:ITER = %SHIP_NAME:SHIP_ID%
	__SHIP_IDENTIFICATION_FLAG:ITER = SHIP_IDENTIFICATION_FLAG:SHIP_ID
	FOR EQUIP_TYPE_ID, 0, EQUIP_TYPE_LENGTH
		FOR SLOT_ID, 0, MAX_SLOT
			__SHIP_EQUIP:EQUIP_TYPE_ID:SLOT_ID:ITER = SHIP_EQUIP:EQUIP_TYPE_ID:SLOT_ID:SHIP_ID
		NEXT
	NEXT
	FOR SHIP_MODEL_ID, 0, SHIP_MODEL_MAX
		FOR EQUIP_TYPE_ID, 0, EQUIP_TYPE_LENGTH
			FOR SLOT_ID, 0, MAX_SLOT
				__SHIP_EQUIP_TEMPLATE:SHIP_MODEL_ID:EQUIP_TYPE_ID:SLOT_ID = SHIP_EQUIP_TEMPLATE:SHIP_MODEL_ID:EQUIP_TYPE_ID:SLOT_ID
			NEXT
		NEXT
	NEXT
	ITER ++
NEXT

VARSET BOARDING_SHIP_ID, 0
VARSET RIDING_WITH, 0
VARSET CHARACTER_POSITION, 0
VARSET MASTER_LEFT_DAY, 0
VARSET MAP, 0
VARSET CLEARMAP, 0
VARSET CHECKED_MAP, 0
VARSET RESOURCE_MAP, 0
VARSET STAR_OWNER, 0
VARSET PORT_POSITION_ID, 0
VARSET PORT_OWNER, 0
VARSET SHIP_CATEGORY, 0
VARSET SHIP_NAME, ""
VARSET SHIP_COUNTRY, 0
VARSET SHIP_POSITION, 0
VARSET MOVING_POS, 0
VARSET FROM_POS, 0
VARSET SHIP_MODEL, 0
VARSET SHIP_CONDITION, 0
VARSET SHIP_IDENTIFICATION_FLAG, 0
FILTER_SHIP_CATEGORY = 0
FILTER_SHIP_MISSION = 0
SORT_SHIP_MISSION = 0
VARSET SHIP_MISSION, 0
VARSET SHIP_FOLLOW, 0
VARSET SHIP_PATROL, 0
VARSET TRADE_ITEM, 0
VARSET SHIP_EQUIP, 0
VARSET SHIP_EQUIP_TEMPLATE, 0
VARSET SIELD_DAMAGE, 0
VARSET SHIP_DAMAGE, 0
VARSET AIR_SHIP_DAMAGE, 0
VARSET REL_LIKE_COUNTRY, 0
VARSET COUNTRY_NAME, ""
VARSET MEETING_POINT, 0
VARSET WAR_PHASE, 0
VARSET WAR_TARGET_POS, 0
VARSET INVASION_ARMY, 0
VARSET 自然生成海賊合流POSID, 0
VARSET MINING_ID, 0
VARSET MINING_POINT, 0
;VARSET HUMAN_LAB, 0
VARSET SLG_ITEM, 0
VARSET SHIP_CARGO, 0
VARSET ITEM_PRICE, 0
VARSET SHOP_ITEMS, 0
VARSET AUTO_SALE, 0
VARSET IS_SALE, 0
VARSET SALE_TARGET, 0
VARSET ITEM_NUM_BORDER, 0
VARSET SHOP_IN_CHARGE, 0
VARSET STAR_PORT_SLOT, 0
VARSET STAR_PORT_CARGO, 0
VARSET PORT_SLOT, 0
VARSET STAR_PORT_CARGO, 0
VARSET PORT_SLOT, 0
VARSET PORT_CARGO, 0
VARSET PORT_RESOURCE, 0
VARSET PORT_COMPLETE, 0
VARSET RESOURCE_RESEARCH_TARGET_FROM_STAR, 0
VARSET RESOURCE_RESEARCH_TARGET_FROM_PORT, 0
VARSET RESOURCE_RESEARCH_DATE_FROM_STAR, 0
VARSET RESOURCE_RESEARCH_DATE_FROM_PORT, 0
VARSET BUILDUP_TARGET_STAR_ID, 0


;-------------------------------------------------
; 国のデータ初期化
;-------------------------------------------------
@INIT_COUNTRY_DATA
#DIM COUNTRY_ID
#DIM QUEST_ID

;嫌われている場合は初期値まで戻す。それ以外は好感度引継ぎ
FOR COUNTRY_ID, 0, MAX_COUNTRY
	SIF REL_LIKE_COUNTRY:COUNTRY_ID:国家ID_プレイヤー < 0
		REL_LIKE_COUNTRY:COUNTRY_ID:国家ID_プレイヤー = 0
NEXT

VARSET PORT_POSITION_ID, 0
VARSET PORT_OWNER, 0
VARSET QUEST_PROGRESS, 0
VARSET QUESTMAP, 0
VARSET QUEST_COMPLETE_DATE, 0
VARSET QUEST_05_FLAG, 0
マップ掃除フラグ = 0
VARSET RENTAL_SHIP, 0
QUEST_61_受注星 = 0
QUEST_63_都市記録Ａ = 0
QUEST_63_都市記録Ｂ = 0
QUEST_63_途絶都市 = 0
ANONYM_SECTOR = 0
ANONYM_X_POS = 0
ANONYM_Y_POS = 0
QUEST_97_旧文明の軍事要塞 = 0
VARSET ANOMALY_MAP, 0
VARSET ANOMALY_PROGRESS, 0
VARSET ANOMALY_POSITIONID, 0
VARSET UNIT_ID, 0
VARSET PMC_QUEST_PROGRESS, 0
PMC_INITED = 0
SPAWN_ZOMBIE = 0
CAPTURE_DOCTOR = 0



;-------------------------------------------------
;「宙域画面」の右カラムオフ判定
;-------------------------------------------------
@SHOP_LIFE_EVENTBUY_COLUMN_RIGHT_OFF_CHECK83

