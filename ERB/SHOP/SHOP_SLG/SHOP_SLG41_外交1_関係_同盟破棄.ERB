;-------------------------------------------------
;同盟を破棄
;-------------------------------------------------
@DIPLOMACY_ALLIANCE_RENOUNCE(ARG:0)
LOCAL:5 = GET_COUNTRY_BOSS(ARG:0)
CALL CHECK_COUNTRY_RELATION(CFLAG:MASTER:所属, ARG:0)
LOCAL:3 = RESULT

IF !GROUPMATCH(LOCAL:3, 1, 3, 4)
	PRINTFORMW 同盟(停戦)破棄は、そもそも同盟(停戦)している勢力にしか行えません
	RETURN 0
ENDIF

PRINTFORML %ANAME(LOCAL:5)%と結んでいる同盟(停戦)を一方的に破棄します
PRINTFORML 相手からはものすごい反発を受けますし、他勢力からもいい顔はされないでしょう
SIF LOCAL:3 == 4
	PRINTFORML 特に%ANAME(LOCAL:5)%とは永久同盟を組んでいるので、反発は凄まじいものになると予想されます
PRINTFORML それでも同盟(停戦)を破棄しますか？
CALL ASK_YN
IF RESULT == 0
	IF GROUPMATCH(LOCAL:3, 3, 4)
		;削除対象となる同盟の検索
		FOR LOCAL, 0, MAX_TREATY_A
			IF TREATY_A_TERM:LOCAL > 0
				FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
					IF TREATY_A_COUNTRY:LOCAL:(LOCAL:1) == CFLAG:MASTER:所属
						FOR LOCAL:2, 0, MAX_TREATY_COUNTRY
							IF TREATY_A_COUNTRY:LOCAL:(LOCAL:2) == ARG:0
								GOTO BREAK_LABEL
							ENDIF
						NEXT
					ENDIF
				NEXT
			ENDIF
		NEXT
		$BREAK_LABEL
		IF LOCAL != MAX_TREATY_A
			PRINTFORML %ANAME(LOCAL:5)%との同盟を破棄しました
			PRINTFORML この行いに、%ANAME(LOCAL:5)%は強い反発を覚えています
			PRINTFORMW また、他の勢力も、不信感を抱いたようです
			FOR LOCAL:1, 0, MAX_COUNTRY
				IF IS_COUNTRY(LOCAL:1) && LOCAL:1 != LOCAL:2
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -300, 300)
					IF TREATY_A_TERM:LOCAL == 9999
						CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -500, 500)
					ENDIF
				ELSEIF IS_COUNTRY(LOCAL:1) && LOCAL:1 == LOCAL:2
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -800, 800)
					IF TREATY_A_TERM:LOCAL == 9999
						CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -1000, 1000)
					ENDIF
				ENDIF
			NEXT
			CALL GO_TO_MASTERS_COUNTRY(TREATY_A_COUNTRY:LOCAL:(LOCAL:2))
			FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
				TREATY_A_COUNTRY:LOCAL:(LOCAL:1) = 0
			NEXT
			TREATY_A_TERM:LOCAL = 0
		ELSE
			PRINTFORMW 同盟破棄を選択した途中でエラーだよ　ここにはこないはずだよ
			PRINTFORMW もしこのメッセージを見かけたら教えてね 喚くより
			RETURN 0
		ENDIF
	ELSE
		;削除対象となる同盟の検索
		FOR LOCAL, 0, MAX_TREATY_C
			IF TREATY_C_TERM:LOCAL > 0
				FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
					IF TREATY_C_COUNTRY:LOCAL:(LOCAL:1) == CFLAG:MASTER:所属
						FOR LOCAL:2, 0, MAX_TREATY_COUNTRY
							IF TREATY_C_COUNTRY:LOCAL:(LOCAL:2) == ARG:0
								GOTO BREAK_LABEL1
							ENDIF
						NEXT
					ENDIF
				NEXT
			ENDIF
		NEXT
		$BREAK_LABEL1
		IF LOCAL != MAX_TREATY_C
			PRINTFORML %ANAME(LOCAL:5)%との停戦を破棄しました
			PRINTFORML この行いに、%ANAME(LOCAL:5)%は強い反発を覚えています
			PRINTFORMW また、他の勢力も、不信感を抱いたようです
			FOR LOCAL:1, 0, MAX_COUNTRY
				IF IS_COUNTRY(LOCAL:1) && LOCAL:1 != LOCAL:2
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -100, 100)
				ELSEIF IS_COUNTRY(LOCAL:1) && LOCAL:1 == LOCAL:2
					CALL CHANGE_RELATION_C_TO_C(LOCAL:1, CFLAG:MASTER:所属, -500, 500)
				ENDIF
			NEXT
			CALL GO_TO_MASTERS_COUNTRY(TREATY_C_COUNTRY:LOCAL:(LOCAL:2))
			FOR LOCAL:1, 0, MAX_TREATY_COUNTRY
				TREATY_C_COUNTRY:LOCAL:(LOCAL:1) = 0
			NEXT
			TREATY_C_TERM:LOCAL = 0
		ELSE
			PRINTFORMW 同盟破棄を選択した途中でエラーだよ　ここにはこないはずだよ
			PRINTFORMW もしこのメッセージを見かけたら教えてね 喚くより
			RETURN 0
		ENDIF
		;同盟破棄による外交印象の悪化
		DIPLOMACY_HATE:(CFLAG:MASTER:所属) += 7
	ENDIF
ELSE
	RETURN 0
ENDIF

