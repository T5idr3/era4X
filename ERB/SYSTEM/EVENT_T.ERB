;EVENT_T.ERB、EVENT_TRAIN、調教時及び調教前後のイベント
@EVENTTRAIN
#PRI
;主人公の射精を0に
BASE:MASTER:2 = 0
;いちおう調教対象と助手も
BASE:TARGET:2 = 0
SIF ASSI >= 0
	BASE:ASSI:2 = 0
BASE:TARGET:3 = 0
BASE:MASTER:4 = 0

;射精限界数の確保
REPEAT CHARANUM
	IF COUNT == MASTER
		CFLAG:COUNT:11 = 10
		SIF TALENT:COUNT:絶倫 == 1
			CFLAG:COUNT:11 += 5
	ELSEIF COUNT == ASSI
		CFLAG:COUNT:11 = 10
	ELSEIF COUNT == TARGET
		CFLAG:COUNT:11 = 10
	ENDIF
REND

;射精後の充填時間をリセット
CFLAG:MASTER:24 = 0
CFLAG:TARGET:24 = 0
SIF ASSI >= 0
	CFLAG:ASSI:24 = 0

;射精フラグ、処女喪失フラグなどをリセット
REPEAT 200
	TFLAG:COUNT = 0
REND

;膣内にヴァギナ汚れを付加
SIF TALENT:オトコ == 0
	STAIN:6 |= 1
SIF TALENT:MASTER:オトコ == 0
	STAIN:MASTER:6 |= 1
IF ASSI >= 0
	SIF TALENT:ASSI:オトコ == 0
		STAIN:ASSI:6 |= 1
ENDIF

;コンドーム自動装着設定のリセット
FLAG:98 = 0

;コンドーム射精フラグをリセット
CFLAG:107 = 0

;調教者は誰か
IF ASSIPLAY == 0
	PLAYER = MASTER
ELSE
	PLAYER = ASSI
ENDIF

@EVENTTURNEND
#PRI
;売却や助手化が可能になったか
SIF TARGET < 0
	RETURN 0

SIF ABL:0+ABL:1 < 6
	RETURN 0
SIF ABL:0 < 4 && ((TALENT:反抗的 && TALENT:服従 == 0 && TALENT:隷属 == 0) || TALENT:気丈)
	RETURN 0
SIF ABL:1 < 4 && (TALENT:自制心 || TALENT:抑圧 || TALENT:抵抗)
	RETURN 0

IF ABL:2 >= 3 || ABL:7 >= 3 || ABL:9 >= 3 || ABL:3+ABL:4+ABL:5+ABL:6 >= 8 || ABL:0 >= 5 || ABL:1 >= 5
	IF CFLAG:1 <= 0
		PRINTFORMW %NAME:TARGET%が売却可能になりました
		CFLAG:1 = 1
	ENDIF
ELSE
	RETURN 0
ENDIF

IF ABL:0+ABL:1+ABL:2+ABL:11 >= 12
	IF CFLAG:1 <= 1
		PRINTFORMW %NAME:TARGET%が助手可能になりました
		CFLAG:1 = 2
	ENDIF
ENDIF

@EVENTTURNEND
IF TARGET >= 0
	;ストレス値の加算
	CFLAG:TARGET:10 += 1
	SIF MARK:3 > 2
		CFLAG:TARGET:10 += 1
	;ストレス値100以上で崩壊を得る
	SIF CFLAG:TARGET:10 >= 100 && TALENT:崩壊 == 0
		CALL COLLAPSE_MIND_TRAIN
ENDIF

IF ASSI >= 0
	IF TALENT:ASSI:妖狐 && ITEM:41 == 0
		PRINTW [妖狐]の効果で媚薬を手に入れました
		ITEM:41 = 1
	ENDIF
ENDIF

REPEAT 100
	SIF ITEM:COUNT < 0
		ITEM:COUNT = 0
REND

RETURN 0

@ASSI_CHANGE
;[狐]かつ技巧LV5、Ｃ感覚LV5で処女
IF TALENT:ASSI:狐 && (ABL:ASSI:2 >= 5 && ABL:ASSI:3 >= 5 && TALENT:ASSI:処女)
	DRAWLINE
	PRINTFORML %NAME:ASSI%は[妖狐]となった
	DRAWLINE
	WAIT
	TALENT:ASSI:狐 = 0
	TALENT:ASSI:妖狐 = 1
ENDIF

$INPUT_LOOP
;[不思議な根]かつＣ感覚LV5、精液中毒LV3以上
IF TALENT:ASSI:不思議な根 && (ABL:ASSI:3 >= 5 && ABL:ASSI:16 >= 3) && TALENT:ASSI:ふたなり == 0 && TALENT:ASSI:オトコ == 0
	DRAWLINE
	PRINTFORML ……どうやら[不思議な根]の効果が現れそうだ
	PRINTFORMW %CALLNAME:ASSI%を[ふたなり]にしますか？
	PRINTL [0] - する
	PRINTL [1] - しない
	INPUT
	IF RESULT == 0
		PRINTFORML %NAME:ASSI%の[不思議な根]は[ふたなり]となった
		TALENT:ASSI:ふたなり = 1
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%は[不思議な根]を失った
	ELSE
		GOTO INPUT_LOOP
	ENDIF
	DRAWLINE
	WAIT
	TALENT:ASSI:不思議な根 = 0
ENDIF

$INPUT_LOOP_2
;[具現]かつ欲望LV5かレズっ気LV4以上
IF TALENT:ASSI:具現 && (ABL:ASSI:1 >= 5 || ABL:ASSI:11 >= 4) && TALENT:ASSI:ふたなり == 0 && TALENT:ASSI:オトコ == 0
	DRAWLINE
	PRINTFORML ……どうやら[具現]の効果が現れそうだ
	PRINTFORML %CALLNAME:ASSI%を[ふたなり]にしますか？
	PRINTL [0] - する
	PRINTL [1] - しない
	INPUT
	IF RESULT == 0
		PRINTFORML %NAME:ASSI%は[具現]によって[ふたなり]となった
		TALENT:ASSI:ふたなり = 1
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%は[具現]を失った
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
	DRAWLINE
	WAIT
	TALENT:ASSI:具現 = 0
ENDIF

ISASSI:ASSI = 1

RETURN 0

@YOUJI
;調教者が幼稚
IF TALENT:PLAYER:幼稚
	PRINTS NAME:PLAYER
	PRINT が乳を吸ううちに
	PRINTS NAME:TARGET
	PRINTW は母乳が出るようになった
	TALENT:母乳体質 = 1
ENDIF

@EVENTCOMEND

IF EXP:Ｖ経験 == 0 && EXP:Ａ経験 > 0 && TALENT:貞操観念 && CFLAG:100
	CFLAG:100 = 1
	PRINTW 貞操を守れるなら、少しは後ろを攻められてもよいと思っているようだ……
ENDIF

;調教で【崩壊】を得た場合のイベント
@COLLAPSE_MIND_TRAIN
PRINTFORMW %CALLNAME:TARGET%の様子がおかしい
PRINTFORMW 激しい調教の影響によって、%CALLNAME:TARGET%の精神に異常をきたしてしまったようだ
PRINTFORMW %NAME:TARGET%は【崩壊】してしまった
TALENT:崩壊 = 1
IF TALENT:恋慕 || TALENT:淫乱 || TALENT:服従 || TALENT:親愛 || TALENT:娼婦 || TALENT:隷属
	PRINTFORM %CALLNAME:TARGET%は[
	SIF TALENT:恋慕
		PRINTS TALENTNAME:3
	SIF TALENT:淫乱
		PRINTS TALENTNAME:4
	SIF TALENT:服従
		PRINTS TALENTNAME:5
	SIF TALENT:親愛
		PRINTS TALENTNAME:6
	SIF TALENT:娼婦
		PRINTS TALENTNAME:7
	SIF TALENT:隷属
		PRINTS TALENTNAME:8
	PRINTW ]を失った
	SIF TALENT:恋慕
		TALENT:恋慕 = 0
	SIF TALENT:淫乱
		TALENT:淫乱 = 0
	SIF TALENT:服従
		TALENT:服従 = 0
	SIF TALENT:親愛
		TALENT:親愛 = 0
	SIF TALENT:娼婦
		TALENT:娼婦 = 0
	SIF TALENT:隷属
		TALENT:隷属 = 0
ENDIF

@EVENTEND
#LATER
PRINTL 調教を終了しました

;調教後行為のチェック
CALL SELF_CHECK

;搾乳した母乳の売却
CALL SELL_MILK

;調教時に録画したビデオを売却
CALL SELL_VIDEO

;調教時に撮影した写真を売却
CALL SELL_PICTURE

;何の珠を得られたか
CALL JUEL_CHECK

;否定の珠の打ち消しチェック
CALL DENIAL_CHECK

BEGIN ABLUP

@JUEL_CHECK
REPEAT 15
	IF PALAM:COUNT < PALAMLV:1
		G = 0
	ELSEIF PALAM:COUNT < PALAMLV:1*3
		G = 1
	ELSEIF PALAM:COUNT < PALAMLV:2
		G = 2
	ELSEIF PALAM:COUNT < PALAMLV:2*3
		G = 10
	ELSEIF PALAM:COUNT < PALAMLV:3
		G = 20
	ELSEIF PALAM:COUNT < PALAMLV:3*2
		G = 100
	ELSEIF PALAM:COUNT < PALAMLV:4
		G = 200
	ELSEIF PALAM:COUNT < PALAMLV:5
		G = 1000
	ELSEIF PALAM:COUNT < PALAMLV:6
		G = 2000
	ELSEIF PALAM:COUNT < PALAMLV:7
		G = 3000
	ELSEIF PALAM:COUNT < PALAMLV:8
		G = 5000
	ELSEIF PALAM:COUNT < PALAMLV:9
		G = 8000
	ELSEIF PALAM:COUNT < 1000000
		G = 12000
	ELSEIF PALAM:COUNT < 5000000
		G = 25000
	ELSEIF PALAM:COUNT < 30000000
		G = 40000
	ELSEIF PALAM:COUNT < 100000000
		G = 60000
	ELSE
		G = 100000
	ENDIF

	IF COUNT == 0
		GOTJUEL:COUNT = G + EX:0 * 1000
	ELSEIF COUNT == 1
		GOTJUEL:COUNT = G + EX:1 * 1000
	ELSEIF COUNT == 2
		GOTJUEL:COUNT = G + EX:2 * 1000
	ELSEIF COUNT == 3
		GOTJUEL:COUNT = G + EX:3 * 1000
	ELSEIF COUNT < 12
		GOTJUEL:COUNT = G
	ELSE
		GOTJUEL:100 += G
	ENDIF
REND

DRAWLINE
PRINTL 調教の結果：
D = 0
REPEAT 15
	IF COUNT == 0
		D = 0
	ELSEIF COUNT == 1
		D = 1
	ELSEIF COUNT == 2
		D = 2
	ELSEIF COUNT == 3
		D = 3
	ELSEIF COUNT == 4
		D = 4
	ELSEIF COUNT == 5
		D = 5
	ELSEIF COUNT == 6
		D = 6
	ELSEIF COUNT == 7
		D = 7
	ELSEIF COUNT == 8
		D = 8
	ELSEIF COUNT == 9
		D = 9
	ELSEIF COUNT == 10
		D = 10
	ELSEIF COUNT == 11
		D = 11
	ELSEIF COUNT == 12
		D = 12
	ELSEIF COUNT == 13
		D = 13
	ELSEIF COUNT == 14
		D = 14
	ENDIF
	
	IF D == 12
		PRINTFORML %PALAMNAME:100%の珠×({JUEL:100}+{GOTJUEL:100})
		JUEL:100 += GOTJUEL:100
	ELSEIF D != 4 && D != 13 && D != 14
		PRINTFORML %PALAMNAME:D%の珠×({JUEL:D}+{GOTJUEL:D})
		JUEL:D += GOTJUEL:D
	ENDIF
	
REND

PRINTW 以上の珠を得ました

@DENIAL_CHECK
SIF JUEL:100 == 0
	RETURN 0

$LABEL_1
A = RAND:3 + 5
B = JUEL:100 / 2
SIF B == 0 && JUEL:100 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:100 -= B

SIF B > 0
	PRINTFORML %PALAMNAME:A%の珠×{B}減少
SIF JUEL:100 > 0 && (JUEL:5 + JUEL:6 + JUEL:7) > 0
	GOTO LABEL_1

$LABEL_2
A = RAND:3 + 5
B = JUEL:100 / 2
SIF B == 0 && JUEL:100 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:100 -= B
SIF B > 0
	PRINTFORML %PALAMNAME:A%の珠×{B}個減少
SIF JUEL:100 > 0 && (JUEL:5 + JUEL:6 + JUEL:7) > 0
	GOTO LABEL_2

DRAWLINE
PRINTL 否定の珠と他の珠の打ち消しが発生しています
PRINTL その結果、
D = 0
REPEAT 13
	IF COUNT == 0
		D = 0
	ELSEIF COUNT == 1
		D = 1
	ELSEIF COUNT == 2
		D = 2
	ELSEIF COUNT == 3
		D = 3
	ELSEIF COUNT == 4
		D = 4
	ELSEIF COUNT == 5
		D = 5
	ELSEIF COUNT == 6
		D = 6
	ELSEIF COUNT == 7
		D = 7
	ELSEIF COUNT == 8
		D = 8
	ELSEIF COUNT == 9
		D = 9
	ELSEIF COUNT == 10
		D = 10
	ELSEIF COUNT == 11
		D = 11
	ELSEIF COUNT == 12
		D = 12
	ENDIF
	

	IF D == 12
		PRINTFORML %PALAMNAME:100%の珠×({JUEL:100})
	ELSEIF D != 4
		PRINTFORML %PALAMNAME:D%の珠×({JUEL:D})
	ENDIF

REND

PRINTW 以上のように変化しました


