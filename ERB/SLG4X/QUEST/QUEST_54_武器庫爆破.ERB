;--------------------------
; !!武器庫爆破と 54を好きな番号に変える！!
; 武器庫爆破
; ここにクエストの説明
;--------------------------


;--------------------------
; クエスト受注可能か
;--------------------------
@QUEST_ACCEPTABLE_54
CALL GET_STAR_ID_FROM_POS(CHARACTER_POSITION)
SIF RESULT != 2
	RETURN 0
SIF QUEST_COMPLETE_DATE:46 + 100 > DAY
	RETURN 0
RETURN QUEST_PROGRESS:34 >= 3
;--------------------------
; クエストの名前を返却
;--------------------------
@QUEST_NAME_54
SETCOLOR 0X00FF00
RESULTS = 武器庫爆破
RETURN

;--------------------------
; クエスト本体
;--------------------------
@QUEST_BODY_54
#DIM SELECTED, MAX_CHARA_NUM
#DIM FIRST_LINE
#DIM SELECTED_COUNT

PRINTFORML 武器庫を爆破することで銀河人民統一連邦の充足を下げることができる
PRINTFORML しかし敵の本拠地の本拠地に乗り込んで爆薬を仕込むため、厳しい連戦が予想される
PRINTFORMW 実行しますか？
CALL ASK_YN
SIF RESULT
	RETURN

FIRST_LINE = LINECOUNT
PRINTL メンバーを選択してください(最大6名)
SETCOLOR 0X666666
CUSTOMDRAWLINE =
RESETCOLOR
$INPUT_LOOP
SELECTED_COUNT = 0
FOR LOCAL, 0, CHARANUM
	SIF CFLAG:LOCAL:所属 != CFLAG:MASTER:所属
		CONTINUE
	SIF SELECTED:LOCAL
		SELECTED_COUNT ++
NEXT
FOR LOCAL, 0, CHARANUM
	SIF CFLAG:LOCAL:所属 != CFLAG:MASTER:所属
		CONTINUE
	IF SELECTED:LOCAL
		SETCOLOR 0X00FF00
		PRINTBUTTON @"[{LOCAL}] %CALLNAME:LOCAL% - 白兵: {ABL:LOCAL:白兵}", LOCAL
		PRINTL
	ELSEIF !SELECTED:LOCAL && SELECTED_COUNT < 6
		PRINTBUTTON @"[{LOCAL}] %CALLNAME:LOCAL% - 白兵: {ABL:LOCAL:白兵}", LOCAL
		PRINTL
	ELSE
		PRINTFORML [{LOCAL}] %CALLNAME:LOCAL% - 白兵: {ABL:LOCAL:白兵}
	ENDIF
	RESETCOLOR
NEXT
SETCOLOR 0X666666
CUSTOMDRAWLINE =
RESETCOLOR
FINDELEMENT SELECTED, 1
IF RESULT == -1
	PRINT [決定]
ELSE
	PRINTBUTTON "[決定]", CHARANUM
ENDIF
PRINT 　
PRINTBUTTON "[キャンセル]", CHARANUM + 1
INPUT
IF RESULT == CHARANUM
	CALL ASSULT_BASE_54(SELECTED)
	RETURN
ENDIF
SIF RESULT == CHARANUM + 1
	RETURN
IF RESULT < 0 || RESULT >= CHARANUM || CFLAG:RESULT:所属 != CFLAG:MASTER:所属
	CLEARLINE LINECOUNT - FIRST_LINE
	GOTO INPUT_LOOP
ENDIF
IF SELECTED:RESULT
	SELECTED:RESULT = 0
ELSEIF SELECTED_COUNT < 6
	SELECTED:RESULT = 1
ENDIF
CLEARLINE LINECOUNT - FIRST_LINE
GOTO INPUT_LOOP



@ASSULT_BASE_54(SELECTED)
#DIM REF SELECTED, 0

PRINTW ………………
PRINTW …………
PRINTW ……
PRINTFORMW 検問を装甲車で突入した%CALLNAME:MASTER%達は、集まってきた兵士たちと即座に交戦を開始した
;白兵戦参加メンバーの初期化
CALL CC_INIT()
;攻撃側キャラクターの設定(最大6名)
FOR LOCAL, 0, CHARANUM
	SIF SELECTED:LOCAL
		CALL CC_ADDCHARA("ATTACKER", LOCAL)
NEXT
CALL CC_ADDMOB("DEFENDER", "歩兵1", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵2", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵3", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵4", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵5", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵6", 1100, 1100, 50)
;連戦フラグオン
CALL CC_SET_FLAG(LINE_CHAN, "1")
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
SIF RESULT == 2
	CALL GAMEOVER_46
CALL CC_ADD_COMBAT_EXP(12)
WAIT

;白兵戦参加メンバーの初期化
CALL CC_INIT()
CALL CC_ADDMOB("DEFENDER", "歩兵7", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵8", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵9", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵10", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵11", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵12", 1100, 1100, 50)
;連戦フラグオン
CALL CC_SET_FLAG(LINE_CHAN, "1")
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
SIF RESULT == 2
	CALL GAMEOVER_46
CALL CC_ADD_COMBAT_EXP(18)

PRINTFORML 第一波を片付けた%CALLNAME:MASTER%の部隊は、武器庫に向かって駆け出した
PRINTFORMW しかし運悪く兵士たちと鉢合わせてしまった

;白兵戦参加メンバーの初期化
CALL CC_INIT()
CALL CC_ADDMOB("DEFENDER", "歩兵13", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵14", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵15", 1100, 1100, 50)
;連戦フラグオン
CALL CC_SET_FLAG(LINE_CHAN, "1")
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
SIF RESULT == 2
	CALL GAMEOVER_46
CALL CC_ADD_COMBAT_EXP(12)

PRINTFORML 敵を倒し、武器庫に侵入した%CALLNAME:MASTER%の部隊
PRINTFORMW 手早く爆弾を仕掛け撤退しようとするも、またもや敵の一団と遭遇してしまった！

;白兵戦参加メンバーの初期化
CALL CC_INIT()
CALL CC_ADDMOB("DEFENDER", "歩兵16", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵17", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵18", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵19", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵20", 1100, 1100, 50)
CALL CC_ADDMOB("DEFENDER", "歩兵21", 1100, 1100, 50)
;連戦フラグオン
CALL CC_SET_FLAG(LINE_CHAN, "1")
;白兵戦イベント呼出
CALL CLOSE_COMBAT()
SIF RESULT == 2
	CALL GAMEOVER_46
CALL CC_ADD_COMBAT_EXP(24)

PRINTFORML ボロボロになりながらもなんとか敵を倒した%CALLNAME:MASTER%の部隊は、急いで警報の鳴り響く基地から逃げ出した
PRINTFORMW その後、起爆された爆弾により武器庫は灰塵と化し、大量の充足が失われた
G戦闘員 -= 30
G充足 -5000