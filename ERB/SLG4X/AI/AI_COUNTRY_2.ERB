;--------------------------
; AI COUNTRY 銀河人民統一連邦家
;--------------------------
@SLG_AI_ACTION_2
#DIM CONST COUNTRY_ID = 2
#DIM SHIPS, SHIP_CLASS_TOTAL_COUNT
#DIM CURRENT_WAITING_SHIPS, SHIP_CLASS_TOTAL_COUNT
#DIM STAR_ID
#DIM SHIP_ID
#DIM NEW_SHIP_ID
#DIM ITER
#DIM IS_COMPLETE
#DIM COUNTER

VARSET SHIPS, 0
VARSET CURRENT_WAITING_SHIPS, 0
IS_COMPLETE = 0
COUNTER = 0

CALL GET_INVASION_ARMY_2(SHIPS)
; 戦争目標が定まっていない場合
IF WAR_PHASE:COUNTRY_ID == 準備 && WAR_TARGET_POS:COUNTRY_ID == 0
    WAR_TARGET_POS:COUNTRY_ID = 星系座標ID:7
    MEETING_POINT:COUNTRY_ID = 星系座標ID:0 - 100
ELSEIF WAR_PHASE:COUNTRY_ID  == 準備
    IF SHIPS:ヴォーロス級コルベット != INVASION_ARMY:COUNTRY_ID:ヴォーロス級コルベット
        FOR STAR_ID, 0, 3
            CALL BUILD_SHIP(星系座標ID:STAR_ID, COUNTRY_ID, COUNTRY_ID, ヴォーロス級コルベット, "侵攻用コルベット", NEW_SHIP_ID)
            IF RESULT == 1
                SHIP_MISSION:NEW_SHIP_ID = 移動
                MOVING_POS:NEW_SHIP_ID = MEETING_POINT:COUNTRY_ID
                INVASION_ARMY:COUNTRY_ID:ヴォーロス級コルベット ++
            ENDIF
        NEXT
    ELSEIF SHIPS:ペルーン級フリゲート != INVASION_ARMY:COUNTRY_ID:ペルーン級フリゲート
        FOR STAR_ID, 0, 3
            CALL BUILD_SHIP(星系座標ID:STAR_ID, COUNTRY_ID, COUNTRY_ID, ペルーン級フリゲート, "侵攻用フリゲート", NEW_SHIP_ID)
            IF RESULT == 1
                SHIP_MISSION:NEW_SHIP_ID = 移動
                MOVING_POS:NEW_SHIP_ID = MEETING_POINT:COUNTRY_ID
                INVASION_ARMY:COUNTRY_ID:ペルーン級フリゲート ++
            ENDIF
        NEXT
    ELSEIF SHIPS:マーチ級駆逐艦 != INVASION_ARMY:COUNTRY_ID:マーチ級駆逐艦
        FOR STAR_ID, 0, 3
            CALL BUILD_SHIP(星系座標ID:STAR_ID, COUNTRY_ID, COUNTRY_ID, マーチ級駆逐艦, "侵攻用駆逐艦", NEW_SHIP_ID)
            IF RESULT == 1
                SHIP_MISSION:NEW_SHIP_ID = 移動
                MOVING_POS:NEW_SHIP_ID = MEETING_POINT:COUNTRY_ID
                INVASION_ARMY:COUNTRY_ID:マーチ級駆逐艦 ++
            ENDIF
        NEXT
    ELSEIF SHIPS:汎用巡洋艦 != INVASION_ARMY:COUNTRY_ID:汎用巡洋艦
        FOR STAR_ID, 0, 3
            CALL BUILD_SHIP(星系座標ID:STAR_ID, COUNTRY_ID, COUNTRY_ID, 汎用巡洋艦, "侵攻用巡洋艦", NEW_SHIP_ID)
            IF RESULT == 1
                SHIP_MISSION:NEW_SHIP_ID = 移動
                MOVING_POS:NEW_SHIP_ID = MEETING_POINT:COUNTRY_ID
                INVASION_ARMY:COUNTRY_ID:汎用巡洋艦 ++
            ENDIF
        NEXT
    ELSE
        WAR_PHASE:COUNTRY_ID = 集合
    ENDIF
ELSEIF WAR_PHASE:COUNTRY_ID == 集合
    FOR SHIP_ID, 0, MAX_SHIP
        SIF SHIP_POSITION:SHIP_ID != MEETING_POINT:COUNTRY_ID
            CONTINUE
        SIF SHIP_COUNTRY:SHIP_ID != COUNTRY_ID
            CONTINUE
        CURRENT_WAITING_SHIPS:(SHIP_MODEL:SHIP_ID) ++
    NEXT
    FOR ITER, 0, SHIP_CLASS_TOTAL_COUNT
        SIF SHIPS:ITER != CURRENT_WAITING_SHIPS:ITER
            IS_COMPLETE = 1
    NEXT
    IF IS_COMPLETE == 0
        WAR_PHASE:COUNTRY_ID = 進撃
        SETCOLOR 0XFF0000
        PRINTL [ニュース] 銀河人民統一連邦が民主主義国に向けて進軍を開始しました
        RESETCOLOR
        WAIT
        WAIT
    ENDIF
ELSEIF WAR_PHASE:COUNTRY_ID == 進撃
    FOR SHIP_ID, 0, MAX_SHIP
        SIF SHIP_COUNTRY:SHIP_ID != COUNTRY_ID
            CONTINUE
        IF SHIP_POSITION:SHIP_ID == MEETING_POINT:COUNTRY_ID && SHIP_MISSION == 待機
            SHIP_MISSION:SHIP_ID = 移動
            MOVING_POS:SHIP_ID = WAR_TARGET_POS:COUNTRY_ID
            COUNTER ++
        ELSEIF SHIP_POSITION:SHIP_ID == WAR_TARGET_POS:COUNTRY_ID
            SHIP_MISSION:SHIP_ID = 移動
            MOVING_POS:SHIP_ID = 星系座標ID:0
            WAR_PHASE:COUNTRY_ID = 退却
        ELSEIF SHIP_MISSION:SHIP_ID == 移動 && MOVING_POS:SHIP_ID == WAR_TARGET_POS:COUNTRY_ID
            COUNTER ++
        ENDIF
    NEXT
    IF WAR_PHASE:COUNTRY_ID == 進撃 && COUNTER < 36
        SETCOLOR 0XFF0000
        PRINTL [ニュース] 損耗が激しいため、銀河人民統一連邦の侵攻部隊は退却しました
        RESETCOLOR
        FOR SHIP_ID, 0, MAX_SHIP
            IF SHIP_COUNTRY:SHIP_ID != COUNTRY_ID
                CONTINUE
            ELSEIF SHIP_MISSION:SHIP_ID == 移動 && MOVING_POS:SHIP_ID == WAR_TARGET_POS:COUNTRY_ID
                SHIP_MISSION:SHIP_ID = 移動
                MOVING_POS:SHIP_ID = 星系座標ID:0
            ENDIF
        NEXT
        WAR_PHASE:COUNTRY_ID = 退却
    ENDIF
ELSEIF WAR_PHASE:COUNTRY_ID == 退却
    WAR_PHASE:COUNTRY_ID = 準備
    FOR SHIP_ID, 0, MAX_SHIP
        SIF SHIP_COUNTRY:SHIP_ID != COUNTRY_ID
            CONTINUE
        SIF SHIP_MISSION:SHIP_ID == パトロール
            CONTINUE
        SIF SHIP_POSITION:SHIP_ID == 星系座標ID:0 || SHIP_POSITION:SHIP_ID == 星系座標ID:1 || SHIP_POSITION:SHIP_ID == 星系座標ID:2
            CONTINUE
        SHIP_MISSION:SHIP_ID = 移動
        MOVING_POS:SHIP_ID = 星系座標ID:0
    NEXT
ENDIF

@GET_STANDING_ARMY_2(UNIT)
#DIM REF UNIT

UNIT:ヴォーロス級コルベット = 50
UNIT:ペルーン級フリゲート = 20
UNIT:マーチ級駆逐艦 = 10

@GET_INVASION_ARMY_2(UNIT)
#DIM REF UNIT
UNIT:ヴォーロス級コルベット = 33
UNIT:ペルーン級フリゲート = 21
UNIT:マーチ級駆逐艦 = 12
UNIT:汎用巡洋艦 = 6

@AI_ARMED_BUILDUP_2(STAR_ID)
#DIM STAR_ID
#DIM DYNAMIC UNIT_LIST, SHIP_CLASS_TOTAL_COUNT
#DIM DYNAMIC NEW_SHIP_ID

CALL GET_STANDING_ARMY_2(UNIT_LIST)

; 艦の生産
FOR LOCAL, 0, MAX_SHIP
    SIF SHIP_POSITION:LOCAL != 星系座標ID:STAR_ID
        CONTINUE
    SIF SHIP_COUNTRY:LOCAL != 国家ID_社会主義
        CONTINUE
    SIF UNIT_LIST:(SHIP_MODEL:LOCAL) > 0
        UNIT_LIST:(SHIP_MODEL:LOCAL) --
    CALL AI_UPDATE_WEAPON_2(LOCAL)
NEXT
FOR LOCAL, 0, SHIP_CLASS_TOTAL_COUNT
    SIF UNIT_LIST:LOCAL > 0
        CALL BUILD_SHIP(星系座標ID:STAR_ID, 国家ID_社会主義, 国家ID_社会主義, LOCAL, ,NEW_SHIP_ID)
NEXT

; 実体弾系 弾幕で勝負してくる
; 民主主義がミサイル主流のため、対抗するべく実体弾系に力を入れた結果
@AI_UPDATE_WEAPON_2(SHIP_ID)
#DIM SHIP_ID
#DIM DYNAMIC SHIP_STATUS, SHIP_STATUS_LENGTH

TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)

SELECTCASE SHIP_MODEL:SHIP_ID
    CASE ヴォーロス級コルベット
        ;メインウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_MAIN_WEAPON_SLOT
            IF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 2, LOCAL)
            ELSEIF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 3, LOCAL)
            ENDIF
        NEXT
        ;サブウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
            IF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 2, LOCAL)
            ELSEIF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 3, LOCAL)
            ENDIF
        NEXT
        ;シールド
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
            IF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 5 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 5, LOCAL)
            ELSEIF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 9 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 9, LOCAL)
            ENDIF
        NEXT
        ;装甲
        FOR LOCAL, 0, SHIP_STATUS:SHIP_ARMOR_SLOT
            IF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 5 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 5, LOCAL)
            ELSEIF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 9 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 9, LOCAL)
            ENDIF
        NEXT
        ;エンジン
        IF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 5 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 5)
        ELSEIF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 9 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 9)
        ENDIF
        ;コンピューター
        IF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 2)
        ELSEIF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 3)
        ENDIF
    CASE ペルーン級フリゲート
        ;メインウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_MAIN_WEAPON_SLOT
            IF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 8 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 8, LOCAL)
            ENDIF
        NEXT
        ;サブウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
            IF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 2, LOCAL)
            ELSEIF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 3, LOCAL)
            ENDIF
        NEXT
        ;シールド
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SIELD_SLOT
            IF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 10, LOCAL)
            ENDIF
        NEXT
        ;装甲
        FOR LOCAL, 0, SHIP_STATUS:SHIP_ARMOR_SLOT
            IF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 10, LOCAL)
            ENDIF
        NEXT
        ;エンジン
        IF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 6)
        ELSEIF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 10)
        ENDIF
        ;コンピューター
        IF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 2)
        ELSEIF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 3)
        ENDIF
    CASE マーチ級駆逐艦
        ;メインウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_MAIN_WEAPON_SLOT
            IF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:主砲:LOCAL:SHIP_ID != 8 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_MAIN_WEAPON(SHIP_ID, 2, 8, LOCAL)
            ENDIF
        NEXT
        ;サブウェポン
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
            IF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 29 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 29, LOCAL)
            ELSEIF !SHIP_EQUIP:副砲:LOCAL:SHIP_ID != 30 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SUB_WEAPON(SHIP_ID, 2, 30, LOCAL)
            ENDIF
        NEXT
        ;シールド
        FOR LOCAL, 0, SHIP_STATUS:SHIP_SIELD_SLOT
            IF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:シールド:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_SIELD(SHIP_ID, 2, 10, LOCAL)
            ENDIF
        NEXT
        ;装甲
        FOR LOCAL, 0, SHIP_STATUS:SHIP_ARMOR_SLOT
            IF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 6, LOCAL)
            ELSEIF !SHIP_EQUIP:装甲:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
                CALL CHANGE_ARMOR(SHIP_ID, 2, 10, LOCAL)
            ENDIF
        NEXT
        ;エンジン
        IF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 6 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 6)
        ELSEIF !SHIP_EQUIP:エンジン:LOCAL:SHIP_ID != 10 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_ENGIN(SHIP_ID, 2, 10)
        ENDIF
        ;コンピューター
        IF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 2 && !IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 2)
        ELSEIF !SHIP_EQUIP:AI:LOCAL:SHIP_ID != 3 && IS_COMPLETE_TECH:OVER_TECH
            CALL CHANGE_COMPUTER(SHIP_ID, 2, 3)
        ENDIF
ENDSELECT
