; TECHNOLOGY
@TECHNOLOGY_LAB()
#DIM PAGE
#DIM TECHNOLOGY_LIST, 7, MAX_TECH
#DIM TECHNOLOGY_COUNT, 7
#DIM MAX_TECH_COUNT

VARSET TECHNOLOGY_COUNT, 0
PAGE = 0

FOR LOCAL, 0, MAX_TECH
  TRYCCALLFORM TECHNOLOGY_TIER_{LOCAL}
    TECHNOLOGY_LIST:(RESULT - 1):(TECHNOLOGY_COUNT:(RESULT - 1)) = LOCAL
    TECHNOLOGY_COUNT:(RESULT - 1) ++
  CATCH
    BREAK
  ENDCATCH
NEXT

DRAWLINE
IF CURRENT_RESEARCH_TECH != -1
  TRYCALLFORM TECHNOLOGY_NAME_{CURRENT_RESEARCH_TECH}
  PRINTFORM 現在研究中の研究は 
  SETCOLOR 0X00FF00
  PRINTFORM %RESULTS% 
  RESETCOLOR
  PRINTFORML です
ELSE
  PRINTFORML 現在研究中の研究はありません
ENDIF
DRAWLINE
MAX_TECH_COUNT = 0
FOR LOCAL, 0, PAGE + 3
  LOCALS = TIER{LOCAL + 1, 28, LEFT}
  PRINTFORM | %LOCALS% 
  ; 現在のページで最もたくさん研究要素があるTIERの要素数を取得
  SIF MAX_TECH_COUNT < TECHNOLOGY_COUNT:LOCAL
    MAX_TECH_COUNT = TECHNOLOGY_COUNT:LOCAL
NEXT
PRINTL |
DRAWLINE
FOR LOCAL, 0, MAX_TECH_COUNT
  PRINT | 
  FOR LOCAL:1, 0, PAGE + 3
    TRYCCALLFORM TECHNOLOGY_NAME_{TECHNOLOGY_LIST:(LOCAL:1):LOCAL}
      IF ((LOCAL:1 == 0 && LOCAL == 0 && TECHNOLOGY_LIST:(LOCAL:1):LOCAL == 0) || TECHNOLOGY_LIST:(LOCAL:1):LOCAL != 0 )
        IF TECHNOLOGY_LIST:(LOCAL:1):LOCAL == CURRENT_RESEARCH_TECH
          SETCOLOR 0X00FF00
        ELSEIF IS_COMPLETE_TECH:(TECHNOLOGY_LIST:(LOCAL:1):LOCAL)
          SETCOLOR 0XFFFF00
        ELSE
          TRYCALLFORM CAN_RESEARCH_TECHNOLOGY_{TECHNOLOGY_LIST:(LOCAL:1):LOCAL}
          SIF !RESULT
            SETCOLOR 0X666666
        ENDIF
        PRINTBUTTON @"[%RESULTS, 30, LEFT%]", TECHNOLOGY_LIST:(LOCAL:1):LOCAL
        RESETCOLOR
      ELSE
        PRINTFORM %"", 32, LEFT%
      ENDIF
    CATCH
      CONTINUE
    ENDCATCH
    PRINT  | 
  NEXT
  PRINTL 
NEXT

WAIT
