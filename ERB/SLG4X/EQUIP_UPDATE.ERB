;---------------------------
; 装備更新
;---------------------------

;---------------------------
; 主砲更新
;---------------------------
@EQUIP_UPDATE_0(SHIP_ID, COUNTRY_ID, SLOT_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM SLOT_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
#DIM SHIP_STATUS, SHIP_STATUS_LENGTH
IF SHIP_CATEGORY:SHIP_ID == 調査船 || SHIP_CATEGORY:SHIP_ID == 輸送船 || SHIP_CATEGORY:SHIP_ID == 作業船
	PRINTW この艦種は主砲を装備できません
	RETURN
ENDIF
$INPUT_LOOP
IF SHIP_CATEGORY:SHIP_ID != 空母
	PRINTFORML      装備名                               ダメージ  射撃レート 命中率  有効距離  サイズ  費用
	DRAWLINE
	FOR ITER, 0, 99
		TRYCCALLFORM GET_MAIN_WEAPON_STATUS_{ITER}(STATUS)
			TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
			SIF SHIP_STATUS:SHIP_MAIN_WEAPON_SIZE < STATUS:SIZE
				CONTINUE
			RESULT = 1
			TRYCALLFORM IS_SALE_MAIN_WEAPON_{ITER}
			SIF RESULT == 0
				CONTINUE
			LOCALS = %TOSTR(STATUS:PRICE, "$####,###")%
			TRYCALLFORM GET_MAIN_WEAPON_NAME_{ITER}
			PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:DAMAGE, 4, RIGHT}\t{STATUS:FIRE_RATE, 2, RIGHT}\t{STATUS:HIT_RATE, 3, RIGHT}\t{STATUS:FIRE_RANGE}\t{STATUS:SIZE}\t%LOCALS%", ITER
			PRINTL
		CATCH
			CONTINUE
		ENDCATCH
	NEXT
	FOR ITER, 185, 191
		TRYCCALLFORM GET_MAIN_WEAPON_STATUS_{ITER}(STATUS)
			TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
			SIF SHIP_STATUS:SHIP_MAIN_WEAPON_SIZE < STATUS:SIZE
				CONTINUE
			RESULT = 1
			TRYCALLFORM IS_SALE_MAIN_WEAPON_{ITER}
			SIF RESULT == 0
				CONTINUE
			LOCALS = %TOSTR(STATUS:PRICE, "$####,###")%
			TRYCALLFORM GET_MAIN_WEAPON_NAME_{ITER}
			PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:DAMAGE, 4, RIGHT}\t{STATUS:FIRE_RATE, 2, RIGHT}\t{STATUS:HIT_RATE, 3, RIGHT}\t{STATUS:FIRE_RANGE}\t{STATUS:SIZE}\t%LOCALS%", ITER
			PRINTL
		CATCH
			CONTINUE
		ENDCATCH
	NEXT
	PRINTBUTTON "[戻る]", 999
	INPUT
	SIF RESULT == 999
		RETURN
	SELECTED = RESULT
	TRYCCALLFORM GET_MAIN_WEAPON_STATUS_{SELECTED}(STATUS)
			TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
			SIF SHIP_STATUS:SHIP_MAIN_WEAPON_SIZE < STATUS:SIZE
			GOTO INPUT_LOOP
		TRYCALLFORM GET_MAIN_WEAPON_DESCRIPTION_{SELECTED}
		IF UPDATE_TEMPLATE
			SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):主砲:SLOT_ID = SELECTED
			RETURN
		ENDIF
		CALL CHECK_BUY
		IF RESULT == 1
			CALL CHANGE_MAIN_WEAPON(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
		ELSE
			GOTO INPUT_LOOP
		ENDIF
	CATCH
		GOTO INPUT_LOOP
	ENDCATCH
ELSE
	PRINTFORML      装備名                            対艦攻撃力 空対空攻撃力  射撃レート  命中率  有効距離  耐久  サイズ  費用
	DRAWLINE
	FOR ITER, 100, 120
TRYCCALLFORM GET_MAIN_WEAPON_STATUS_{ITER}(STATUS)
			TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
			SIF SHIP_STATUS:SHIP_MAIN_WEAPON_SIZE < STATUS:SIZE
				CONTINUE
			RESULT = 1
			TRYCALLFORM IS_SALE_MAIN_WEAPON_{ITER}
			SIF RESULT == 0
				CONTINUE
			LOCALS = %TOSTR(STATUS:PRICE, "$####,###")%
			TRYCALLFORM GET_MAIN_WEAPON_NAME_{ITER}
			PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:DAMAGE, 3, RIGHT}\t{STATUS:ANTI_AIR, 3, RIGHT}\t{STATUS:FIRE_RATE, 3, RIGHT}\t{STATUS:HIT_RATE, 3, RIGHT}\t{STATUS:FIRE_RANGE}\t{AIR_SHIP_HP, 4, RIGHT}\t{STATUS:SIZE}\t%LOCALS%", ITER
			PRINTL
		CATCH
			CONTINUE
		ENDCATCH
	NEXT
	PRINTBUTTON "[戻る]", 999
	INPUT
	SIF RESULT == 999
		RETURN
	SELECTED = RESULT
	TRYCCALLFORM GET_MAIN_WEAPON_STATUS_{SELECTED}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_MAIN_WEAPON_SIZE < STATUS:SIZE
			GOTO INPUT_LOOP
		TRYCALLFORM GET_MAIN_WEAPON_DESCRIPTION_{SELECTED}
		IF UPDATE_TEMPLATE
			SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):主砲:SLOT_ID = SELECTED
			RETURN
		ENDIF
		CALL CHECK_BUY
		IF RESULT == 1
			CALL CHANGE_MAIN_WEAPON(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
		ELSE
			GOTO INPUT_LOOP
		ENDIF
	CATCH
		GOTO INPUT_LOOP
	ENDCATCH
ENDIF

;---------------------------
; 副砲更新
;---------------------------
@EQUIP_UPDATE_1(SHIP_ID, COUNTRY_ID, SLOT_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM SLOT_ID
#DIM UPDATE_TEMPLATE
#DIM COUNTRY
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
#DIM SHIP_STATUS, SHIP_STATUS_LENGTH
IF SHIP_CATEGORY:SHIP_ID == 調査船 || SHIP_CATEGORY:SHIP_ID == 輸送船 || SHIP_CATEGORY:SHIP_ID == 作業船
	PRINTW この艦種は副砲を装備できません
	RETURN
ENDIF
$INPUT_LOOP
PRINTFORML      装備名                          ダメージ  射撃レート 命中率 対空 有効距離  サイズ  費用
DRAWLINE
FOR ITER, 0, 40
	TRYCCALLFORM GET_SUB_WEAPON_STATUS_{ITER}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_SUB_WEAPON_SIZE < STATUS:SIZE
			CONTINUE
		RESULT = 1
		TRYCALLFORM IS_SALE_SUB_WEAPON_{ITER}
		SIF RESULT == 0
			CONTINUE
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		TRYCALLFORM GET_SUB_WEAPON_NAME_{ITER}
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 30, LEFT% {STATUS:DAMAGE, 4, RIGHT}\t{STATUS:FIRE_RATE, 2, RIGHT}\t{STATUS:HIT_RATE, 3, RIGHT}\t{STATUS:ANTI_AIR, 3, RIGHT}\t{STATUS:FIRE_RANGE}\t{STATUS:SIZE}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
FOR ITER, 99, 105
	TRYCCALLFORM GET_SUB_WEAPON_STATUS_{ITER}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_SUB_WEAPON_SIZE < STATUS:SIZE
			CONTINUE
		RESULT = 1
		TRYCALLFORM IS_SALE_SUB_WEAPON_{ITER}
		SIF RESULT == 0
			CONTINUE
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		TRYCALLFORM GET_SUB_WEAPON_NAME_{ITER}
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 30, LEFT% {STATUS:DAMAGE, 4, RIGHT}\t{STATUS:FIRE_RATE, 2, RIGHT}\t{STATUS:HIT_RATE, 3, RIGHT}\t{STATUS:ANTI_AIR, 3, RIGHT}\t{STATUS:FIRE_RANGE}\t{STATUS:SIZE}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_SUB_WEAPON_STATUS_{SELECTED}(STATUS)
	TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
	SIF SHIP_STATUS:SHIP_SUB_WEAPON_SIZE < STATUS:SIZE
		GOTO INPUT_LOOP
	TRYCALLFORM GET_SUB_WEAPON_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):副砲:SLOT_ID = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_SUB_WEAPON(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH
;---------------------------
; シールド更新
;---------------------------
@EQUIP_UPDATE_2(SHIP_ID, COUNTRY_ID, SLOT_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM SLOT_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
#DIM SHIP_STATUS, SHIP_STATUS_LENGTH
$INPUT_LOOP
PRINTFORML      装備名                               シールド値  シールド自動回復値  サイズ  費用
FOR ITER, 0, 40
	TRYCCALLFORM GET_SIELD_STATUS_{ITER}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_SIELD_SIZE != STATUS:SIZE
			CONTINUE
		RESULT = 1
		TRYCALLFORM IS_SALE_SIELD_{ITER}
		SIF RESULT == 0
			CONTINUE
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		TRYCALLFORM GET_SIELD_NAME_{ITER}
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:SIELD, 4, RIGHT}\t{STATUS:SIELD_RECOVER, 2, RIGHT}\t{STATUS:SIZE}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_SIELD_STATUS_{SELECTED}(STATUS)
	TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
	SIF SHIP_STATUS:SHIP_SIELD_SIZE != STATUS:SIZE
		GOTO INPUT_LOOP
	TRYCALLFORM GET_SIELD_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):シールド:SLOT_ID = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_SIELD(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH
;---------------------------
; 装甲更新
;---------------------------
@EQUIP_UPDATE_3(SHIP_ID, COUNTRY_ID, SLOT_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM SLOT_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
#DIM SHIP_STATUS, SHIP_STATUS_LENGTH
$INPUT_LOOP
PRINTFORML      装備名                                  装甲  サイズ  費用
FOR ITER, 0, 50
	TRYCCALLFORM GET_ARMOR_STATUS_{ITER}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_ARMOR_SIZE != STATUS:SIZE
			CONTINUE
		RESULT = 1
		TRYCALLFORM IS_SALE_ARMOR_{ITER}
		SIF RESULT == 0
			CONTINUE
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		TRYCALLFORM GET_ARMOR_NAME_{ITER}
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:ARMOR, 4, RIGHT}\t{STATUS:SIZE}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_ARMOR_STATUS_{SELECTED}(STATUS)
	TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
	SIF SHIP_STATUS:SHIP_ARMOR_SIZE != STATUS:SIZE
		GOTO INPUT_LOOP
	TRYCALLFORM GET_ARMOR_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):装甲:SLOT_ID = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_ARMOR(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH
;---------------------------
; エンジン更新
;---------------------------
@EQUIP_UPDATE_4(SHIP_ID, COUNTRY_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
#DIM SHIP_STATUS, SHIP_STATUS_LENGTH
$INPUT_LOOP
PRINTFORML      装備名                               スピード  回避  サイズ  費用
FOR ITER, 0, 20
	TRYCCALLFORM GET_ENGIN_STATUS_{ITER}(STATUS)
		TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
		SIF SHIP_STATUS:SHIP_ENGIN_SIZE != STATUS:SIZE
			CONTINUE
		RESULT = 1
		TRYCALLFORM IS_SALE_ENGIN_{ITER}
		SIF RESULT == 0
			CONTINUE
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		TRYCALLFORM GET_ENGIN_NAME_{ITER}
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:SPEED}\t{STATUS:AVOID, 3, RIGHT}\t{STATUS:SIZE}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_ENGIN_STATUS_{SELECTED}(STATUS)
	TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(SHIP_STATUS)
	SIF SHIP_STATUS:SHIP_ENGIN_SIZE != STATUS:SIZE
		GOTO INPUT_LOOP
	TRYCALLFORM GET_ENGIN_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):エンジン:0 = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_ENGIN(SHIP_ID, COUNTRY_ID, SELECTED)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH
;---------------------------
; AI更新
;---------------------------
@EQUIP_UPDATE_5(SHIP_ID, COUNTRY_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
$INPUT_LOOP
PRINTFORML      %"装備名", 40, LEFT%費用
FOR ITER, 0, 10
	TRYCCALLFORM GET_COMPUTER_STATUS_{ITER}(STATUS)
		RESULT = 1
		TRYCALLFORM IS_SALE_COMPUTER_{ITER}
		SIF RESULT == 0
			CONTINUE
		TRYCALLFORM GET_COMPUTER_NAME_{ITER}
		LOCALS = %TOSTR(STATUS:PRICE, "$###,###")%
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT%%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_COMPUTER_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):AI:0 = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_COMPUTER(SHIP_ID, COUNTRY_ID, SELECTED)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH
;---------------------------
; センサー更新
;---------------------------
@EQUIP_UPDATE_6(SHIP_ID, COUNTRY_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
$INPUT_LOOP
PRINTFORML      装備名                               センサー範囲  費用
FOR ITER, 0, 10
	TRYCCALLFORM GET_SENSOR_STATUS_{ITER}(STATUS)
		RESULT = 1
		TRYCALLFORM IS_SALE_SENSOR_{ITER}
		SIF RESULT == 0
			CONTINUE
		TRYCALLFORM GET_SENSOR_NAME_{ITER}
		LOCALS = %TOSTR(STATUS:PRICE, "$####,###")%
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT% {STATUS:SENSOR}\t%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_SENSOR_DESCRIPTION_{SELECTED}
	IF UPDATE_TEMPLATE
		PRINTFORML センサー:選択{SELECTED}
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):センサー:0 = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_SENSOR(SHIP_ID, COUNTRY_ID, SELECTED)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH

;---------------------------
; オプション更新
;---------------------------
@EQUIP_UPDATE_7(SHIP_ID, COUNTRY_ID, SLOT_ID, UPDATE_TEMPLATE = 0)
#DIM SHIP_ID
#DIM COUNTRY_ID
#DIM SLOT_ID
#DIM UPDATE_TEMPLATE
#DIM ITER
#DIM SELECTED
#DIM STATUS, STATUS_LENGTH
DEBUGPRINTFORM {SLOT_ID}
$INPUT_LOOP
PRINTFORML      %"装備名", 40, LEFT%費用
FOR ITER, 0, 10
	TRYCCALLFORM GET_OPTION_STATUS_{ITER}(STATUS)
		RESULT = 1
		TRYCALLFORM IS_SALE_OPTION_{ITER}
		SIF RESULT == 0
			CONTINUE
		TRYCALLFORM GET_OPTION_NAME_{ITER}
		LOCALS = %TOSTR(STATUS:PRICE, "$####,###")%
		PRINTBUTTON @"[{ITER, 3, RIGHT}] %RESULTS, 40, LEFT%%LOCALS%", ITER
		PRINTL
	CATCH
		CONTINUE
	ENDCATCH
NEXT
PRINTBUTTON "[戻る]", 999
INPUT
SIF RESULT == 999
	RETURN
SELECTED = RESULT
TRYCCALLFORM GET_OPTION_DESCRIPTION_{SELECTED}
	;積載量に変更を加えるタイプのオプションは積載中は変更できないようにする
	TRYCALLFORM GET_OPTION_TYPE_{SHIP_EQUIP:オプション:SLOT_ID:SHIP_ID}
	IF  RESULTS == "ADD_CONTAINER"
		CALL SUM_CARGO_SIZE(SHIP_ID)
		IF RESULT > 0
			PRINTFORMW 貨物の搭載中はコンテナ装備の変更は行えません
			GOTO INPUT_LOOP
		ENDIF
	ENDIF
	IF UPDATE_TEMPLATE
		SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):オプション:SLOT_ID = SELECTED
		RETURN
	ENDIF
	CALL CHECK_BUY
	IF RESULT == 1
		CALL CHANGE_OPTION(SHIP_ID, COUNTRY_ID, SELECTED, SLOT_ID)
	ELSE
		GOTO INPUT_LOOP
	ENDIF
CATCH
	GOTO INPUT_LOOP
ENDCATCH

;---------------------------
; 購入確認
;---------------------------
@CHECK_BUY
DRAWLINE
$INPUT_LOOP
PRINTL 購入しますか？
PRINTBUTTON "[0] 購入", 0
PRINT  
PRINTBUTTON "[1] 戻る", 1
PRINTL
INPUT
IF RESULT == 0
	IF PRICE > MONEY
		SETCOLOR 0XFF0000
		PRINTW 資金不足で買えませんでした
		RESETCOLOR
		RETURN 0
	ENDIF
	RETURN 1
ELSEIF RESULT == 1
	RETURN 0
ELSE
	CLEARLINE 3
	GOTO INPUT_LOOP
ENDIF

;---------------------------
; テンプレートで購入確認
;---------------------------
@EQUIP_UPDATE_BY_TEMPLATE(SHIP_ID, OWNER)
#DIM SHIP_ID
#DIM OWNER
{
	#DIMS CONST EQUIP_TYPE_NAME_EN = "MAIN_WEAPON", "SUB_WEAPON", "SIELD",
	"ARMOR", "ENGIN", "COMPUTER", "SENSOR", "OPTION"
}
#DIM DYNAMIC _EQUIP_TYPE
#DIM DYNAMIC _SLOT_ID
#DIM DYNAMIC _EQUIP_ID
#DIM DYNAMIC _SHIP_STATUS, SHIP_STATUS_LENGTH
#DIM DYNAMIC _MAX_SLOT

TRYCALLFORM GET_SHIP_STATUS_{SHIP_MODEL:SHIP_ID}(_SHIP_STATUS)

$INPUT_LOOP
PRINTFORML 現在のテンプレート

FOR _EQUIP_TYPE, 0, EQUIP_TYPE_LENGTH
	SELECTCASE _EQUIP_TYPE
		CASE 主砲
			_MAX_SLOT = _SHIP_STATUS:SHIP_MAIN_WEAPON_SLOT
		CASE 副砲
			_MAX_SLOT = _SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
		CASE シールド
			_MAX_SLOT = _SHIP_STATUS:SHIP_SIELD_SLOT
		CASE 装甲
			_MAX_SLOT = _SHIP_STATUS:SHIP_ARMOR_SLOT
		CASE オプション
			_MAX_SLOT = _SHIP_STATUS:SHIP_OPTION_SLOT
		CASEELSE
			_MAX_SLOT = 0
	ENDSELECT
	IF _MAX_SLOT
		FOR _SLOT_ID, 0, _MAX_SLOT
			IF !SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID
				SELECTCASE _EQUIP_TYPE
					CASE 主砲
						IF SHIP_CATEGORY:SHIP_ID == 空母
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 101
						ELSE
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 1
						ENDIF
					CASE 副砲
						SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 1
					CASE シールド
						IF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, コルベット, 調査船, 輸送船, 作業船)
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 1
						ELSEIF SHIP_CATEGORY:SHIP_ID == フリゲート || SHIP_CATEGORY:SHIP_ID == 駆逐艦
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 2
						ELSEIF SHIP_CATEGORY:SHIP_ID == 巡洋艦
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 3
						ELSEIF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, 戦艦, 空母)
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 4
						ENDIF
					CASE 装甲
						IF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, コルベット, 調査船, 輸送船, 作業船)
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 1
						ELSEIF SHIP_CATEGORY:SHIP_ID == フリゲート || SHIP_CATEGORY:SHIP_ID == 駆逐艦
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 2
						ELSEIF SHIP_CATEGORY:SHIP_ID == 巡洋艦
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 3
						ELSEIF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, 戦艦, 空母)
							SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 4
						ENDIF
				ENDSELECT
			ENDIF
			RESULTS = 
			TRYCALLFORM GET_%EQUIP_TYPE_NAME_EN:_EQUIP_TYPE%_NAME_{SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID}
			PRINTBUTTON @"%EQUIP_CATEGORY_NAME:_EQUIP_TYPE%{_SLOT_ID}: %RESULTS%", _EQUIP_TYPE * 100 + _SLOT_ID
			PRINTL
		NEXT
	ELSE
		IF !SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0
			SELECTCASE _EQUIP_TYPE
				CASE エンジン
					IF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, コルベット, 調査船, 輸送船, 作業船)
						SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 1
					ELSEIF SHIP_CATEGORY:SHIP_ID == フリゲート || SHIP_CATEGORY:SHIP_ID == 駆逐艦
						SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 2
					ELSEIF SHIP_CATEGORY:SHIP_ID == 巡洋艦
						SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 3
					ELSEIF GROUPMATCH(SHIP_CATEGORY:SHIP_ID, 戦艦, 空母)
						SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 4
					ENDIF
				CASE AI
					SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 1
				CASE センサー
					SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 1
			ENDSELECT
		ENDIF
		RESULTS = 
		TRYCALLFORM GET_%EQUIP_TYPE_NAME_EN:_EQUIP_TYPE%_NAME_{SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0}
		PRINTBUTTON @"%EQUIP_CATEGORY_NAME:_EQUIP_TYPE%: %RESULTS%", _EQUIP_TYPE * 100 + 0
		PRINTL
	ENDIF
NEXT

DRAWLINE
PRINTBUTTON "[これで購入]", -1
PRINTL
PRINTBUTTON "[キャンセル]", -2
INPUT
IF RESULT == -1
	FOR _EQUIP_TYPE, 0, EQUIP_TYPE_LENGTH
		SELECTCASE _EQUIP_TYPE
			CASE 主砲
				_MAX_SLOT = _SHIP_STATUS:SHIP_MAIN_WEAPON_SLOT
			CASE 副砲
				_MAX_SLOT = _SHIP_STATUS:SHIP_SUB_WEAPON_SLOT
			CASE シールド
				_MAX_SLOT = _SHIP_STATUS:SHIP_SIELD_SLOT
			CASE 装甲
				_MAX_SLOT = _SHIP_STATUS:SHIP_ARMOR_SLOT
			CASE オプション
				_MAX_SLOT = _SHIP_STATUS:SHIP_OPTION_SLOT
			CASEELSE
				_MAX_SLOT = 0
		ENDSELECT
		IF _MAX_SLOT
			FOR _SLOT_ID, 0, _MAX_SLOT
				IF SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID
					SIF SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID != SHIP_EQUIP:_EQUIP_TYPE:_SLOT_ID:SHIP_ID
						TRYCALLFORM CHANGE_%EQUIP_TYPE_NAME_EN:_EQUIP_TYPE%(SHIP_ID, OWNER, SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID, _SLOT_ID)
				ELSE
					SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID = 0
					SHIP_EQUIP:_EQUIP_TYPE:_SLOT_ID:SHIP_ID = SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:_SLOT_ID
				ENDIF
			NEXT
		ELSE
			IF SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0
				SIF SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 != SHIP_EQUIP:_EQUIP_TYPE:0:SHIP_ID
					TRYCALLFORM CHANGE_%EQUIP_TYPE_NAME_EN:_EQUIP_TYPE%(SHIP_ID, OWNER, SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0)
			ELSE
				SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0 = 0
				SHIP_EQUIP:_EQUIP_TYPE:0:SHIP_ID = SHIP_EQUIP_TEMPLATE:(SHIP_MODEL:SHIP_ID):_EQUIP_TYPE:0
			ENDIF
		ENDIF
	NEXT
ELSEIF RESULT == -2
	RETURN
ELSE
	_EQUIP_TYPE = RESULT / 100
	_SLOT_ID = RESULT % 100
	IF GROUPMATCH(_EQUIP_TYPE, 主砲, 副砲, シールド, 装甲, オプション)
		TRYCALLFORM EQUIP_UPDATE_{_EQUIP_TYPE}(SHIP_ID, OWNER, _SLOT_ID, 1)
	ELSE
		TRYCALLFORM EQUIP_UPDATE_{_EQUIP_TYPE}(SHIP_ID, OWNER, 1)
	ENDIF
	GOTO INPUT_LOOP
ENDIF