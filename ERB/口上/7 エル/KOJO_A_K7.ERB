;-------------------------------------------------
;「会いに行く」「閨に呼ぶ」「子育て」「捕虜会話」の口上
;-------------------------------------------------

;=================================================
;●「会いに行く」の開始時のセリフ
;=================================================
@KOJO_TRAIN_START_A1_K7
	;[虚ろ]状態なら口上を表示しない
	IF TALENT:虚ろ || CFLAG:400 == 1
		RETURN
	ENDIF
	;━━━━━━━━━━━━━━━━━━━━

	;━━━━━━━━━━━━━━━━━━━━
	IF CFLAG:400 == 0
		PRINTFORML  口上を選択してください
			PRINTL [0] 口上を使用しない
			PRINTL [1] エル口上

			$INPUT_LOOP
			INPUT

			IF RESULT == 0
				PRINTFORMW  口上を使用しません
				CFLAG:400 = 1
				RETURN
			ELSEIF RESULT == 1
				PRINTFORMW  エル口上を使用します
				CFLAG:400 = 2

				ENDIF
	ENDIF

	;
	;
	;
	;━━━━━━━━━━━━━━━━━━━━
	;━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

	;-------------------------------------------------
	;初回
	;-------------------------------------------------
	IF CFLAG:200 == 0
		CFLAG:200 = 1
		;初対面の場合
		IF !CFLAG:17
		
		;既に会ったことがある場合
		ELSE
		ENDIF

	;-------------------------------------------------
	;開始時(1回のみ)
	;-------------------------------------------------
	;既成事実Lv3(初めてセックスをした次の回)
	ELSEIF CFLAG:200 < 5 && MARK:2 == 3
	CFLAG:200 = 5
	;既成事実Lv2(恋人になった次の回)
	ELSEIF CFLAG:200 < 4 && MARK:2 == 2
	CFLAG:200 = 4
	;既成事実Lv1(初めてキスをした次の回)
	ELSEIF CFLAG:200 < 3 && MARK:2 == 1
	CFLAG:200 = 3
	;既成事実Lv0で恋慕
	ELSEIF CFLAG:200 < 2 && MARK:2 == 0 && TALENT:恋慕
	CFLAG:200 = 2
	;-------------------------------------------------
	;開始時(2回目以降)
	;-------------------------------------------------
	;既成事実Lv3かつ恋慕
	ELSEIF MARK:2 == 3 && TALENT:恋慕
	SELECTCASE RAND:2
			CASE 0

			CASE 1

			ENDSELECT
	;既成事実Lv3(セックス済み)
	ELSEIF MARK:2 == 3

	;既成事実Lv2(恋人)
	ELSEIF MARK:2 == 2
	;既成事実Lv1(キス済み)
	ELSEIF MARK:2 == 1

	;既成事実Lv0で恋慕
	ELSEIF MARK:2 == 0 && TALENT:恋慕

	;既成事実Lv0
	ELSEIF MARK:2 == 0

	ENDIF

RESETCOLOR
RETURN 0

;=================================================
;●「会いに行く」の終了時のセリフ
;=================================================
@KOJO_TRAIN_END_A1_K7
;[虚ろ]状態なら口上を表示しない
IF TALENT:虚ろ || CFLAG:400 == 1
	RETURN
ENDIF

;-------------------------------------------------
;行動不能の場合
;-------------------------------------------------
;酒酔いによる行動不能
IF TCVAR:53 == 1
	;PRINTFORMW  
;快感のあまり気絶 or 気力300以下
ELSEIF TCVAR:52 || BASE:気力 <= 300
	;PRINTFORMW  
;疲労による行動不能
ELSEIF TCVAR:51
	;PRINTFORMW  
ENDIF

;-------------------------------------------------
;終了時(1回のみ)
;-------------------------------------------------
;既成事実Lv3(初めてセックスをした)
IF CFLAG:201 < 5 && MARK:2 == 3
	CFLAG:201 = 5
	;行動不能ならフラグだけ立てて表示はしない
	IF !(TCVAR:51 || TCVAR:52 || TCVAR:53)
		PRINTFORMW 「……これはなんというかその……気恥ずかしいな……」 

	ENDIF
;既成事実Lv2(恋人になった)
ELSEIF CFLAG:201 < 4 && MARK:2 == 2
	CFLAG:201 = 4
	;行動不能ならフラグだけ立てて表示はしない
	IF !(TCVAR:51 || TCVAR:52 || TCVAR:53)
		PRINTFORMW 「……これはなんというかその……気恥ずかしいな……」 
	ENDIF
;既成事実Lv1(初めてキスをした)
ELSEIF CFLAG:201 < 3 && MARK:2 == 1
	CFLAG:201 = 3
	;行動不能ならフラグだけ立てて表示はしない
	IF !(TCVAR:51 || TCVAR:52 || TCVAR:53)
	ENDIF

;-------------------------------------------------
;終了時(2回目以降)
;-------------------------------------------------
;行動不能なら非表示
ELSEIF !(TCVAR:51 || TCVAR:52 || TCVAR:53)
	;既成事実Lv3かつ恋慕
	IF MARK:2 == 3 && TALENT:恋慕
	;既成事実Lv3(セックス済み)
	ELSEIF MARK:2 == 3
	;既成事実Lv2(恋人)
	ELSEIF MARK:2 == 2
	;既成事実Lv1(キス済み)
	ELSEIF MARK:2 == 1
	;既成事実Lv0で恋慕
	ELSEIF MARK:2 == 0 && TALENT:恋慕
	;既成事実Lv0
	ELSEIF MARK:2 == 0
	ENDIF
ENDIF

;=================================================
;●「閨に呼ぶ」の開始時のセリフ ※単独で呼ばれた場合のみ呼ばれる
;=================================================
@KOJO_TRAIN_START_A2_K3007
;[虚ろ]状態なら口上を表示しない
IF TALENT:虚ろ || CFLAG:400 == 1
	RETURN
ENDIF

;=================================================
;●「閨に呼ぶ」の終了時のセリフ ※単独で呼ばれた場合のみ呼ばれる
;=================================================
@KOJO_TRAIN_END_A2_K3007
;[虚ろ]状態なら口上を表示しない
IF TALENT:虚ろ || CFLAG:400 == 1
	RETURN
ENDIF

;酒酔いによる行動不能
IF TCVAR:53 == 1
	;PRINTFORMW  
;快感のあまり気絶 or 気力300以下
ELSEIF TCVAR:52 || BASE:気力 <= 300
	;PRINTFORMW  
;疲労による行動不能
ELSEIF TCVAR:51
	;PRINTFORMW  
ELSE
	;PRINTFORMW  
ENDIF

;=================================================
;●コマンド実行前(このキャラがターゲット側のとき)
;※地の文が表示される前に実行される。戻り値に1を設定する(RETURN 1)と地の文がカットされる
;  必要に応じてKOJO_COM_TARGETの代わりに使う
;=================================================
@KOJO_COM_BEFORE_TARGET_A_K3007
;[虚ろ]状態の場合、口が塞がっている場合は口上を表示しない
IF TALENT:虚ろ || IS_EQUIP_CONTINUE(TARGET, "口装着") || CFLAG:400 == 1
	RETURN 0
ENDIF

RETURN 0

;=================================================
;●コマンド実行前(このキャラがプレイヤー側のとき)
;※地の文が表示される前に実行される。戻り値に1を設定する(RETURN 1)と地の文がカットされる
;  必要に応じてKOJO_COM_PLAYERの代わりに使う
;=================================================
@KOJO_COM_BEFORE_PLAYER_A_K3007
;[虚ろ]状態の場合、口が塞がっている場合は口上を表示しない
IF TALENT:虚ろ || IS_EQUIP_CONTINUE(TARGET, "口装着") || CFLAG:400 == 1
	RETURN 0
ENDIF

RETURN 0
