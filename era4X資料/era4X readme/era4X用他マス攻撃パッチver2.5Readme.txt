era4X用他マス攻撃パッチver2.5

◇パッチの目的
射程4の武器で隣のマスに攻撃できる様にする。
とりあえずは攻撃場所の指定との兼ね合いや参考に出来る指定座標への自動航行があったので、クリックして座標を指定しないと遠隔攻撃コマンドは出ない様になっています。

NEW!　(無抵抗で攻撃を受け続ける理由もないので)敵艦隊が健在の場合、攻撃元へと突っ込んでくる様にしました。
	「敵の行動としての他マス攻撃行動」が用意できていないので、とりあえずは4射程武器を持った敵も突っ込んできます。(他マス攻撃行動を用意できたら差し替え予定です)


◇具体的な変更点

SLG.ERHに追加
#DIM CONST 攻撃不能 = 6

戦闘中に攻撃不能である事を示す定数です。
遠隔攻撃における反撃・移動はSLGターンを消費して行うべき行動(遠隔攻撃を受けた分だけ追加で戦闘・反撃できるのは変では？)なので、被攻撃側は攻撃の代わりに攻撃不能になります。(撤退は勝敗条件に関わるので「勝敗には関わらないけど攻撃はできない」攻撃不能状態の代替にはなりません)


追加ファイルOTHER_GRID_ATTACK.ERB

大体はコメントに書いてある通りです。
@OTHER_GRID_ATTACKは@BATTLEから移動と2番目の勢力の行動を省いて、ターン制限を加えた感じの他マスへの攻撃の本体です。攻撃などは@BATTLEと全く同じ関数を利用しています。

@OTHER_GRID_TARGETINGは@COMBATと役割は大体同じですが、攻撃側の前提条件の確認に関してはこれを呼ぶ前の段階でやってる事を前提にしています(「攻撃側の射程内に居るはず」の防御側の場所が指定されている以上、正常に動作している場合には無駄に再確認するだけになるのでは)

@SLG_SHOPに「遠隔攻撃」の表示とその処理を追加


◇備考
@OTHER_GRID_ATTACKが距離4の入ったデータを表示用関数に送るとUIが崩れるので暫定的に距離データにUI表示用のダミーが存在しています。

暫定的に処理上は射程5以降の武器があるなら2マス先以降にも攻撃可能になる(はず)になっています。

暫定的に特に指定が無い場合には「1SLGターンを使って3戦闘ターン分の攻撃を行う」処理になっています。
(通常の戦闘から移動などがSLGターン側に移動した格好です)

暫定的に(他マスのそれを回収しに行けるとは考え難いので)報酬は手に入りません。(前回更新時には表記忘れ)

2023/01/18の更新で指揮官選択処理である@COMMANDER_ELECTIONにメッセージが追加されたので
暫定的な対応として旧処理をそのままコピーした「@OLD_COMMANDER_ELECTION」を使用する事でメッセージを迂回しています。

◇更新履歴
2023/01/25版
敵艦隊が健在の場合には敵が「自身らの行動として」移動して戦闘をしようとする様に
その他2023/01/18の更新で行われた戦闘周りの刷新に絡んでの細かい修正など

2023/01/20版
2023/01/18の更新で行われた戦闘周りの刷新に一応対応
最終ターンの結果を見られる様に処理を追加

2023/01/15版
初期版を公開