非プレイヤー勢力指揮官設定パッチ

◇やりたい事
プレイヤー以外の艦隊にも指揮官を設定できる様にしたい。
とりあえずはクエスト進捗が0ではないクエスト(QUEST_PROGRESS:クエスト番号 != 0)の旗艦(QUEST_FLAG_SHIP_ID:クエスト番号 にIDが入っている船)の艦長(BOARDING_SHIP_ID:キャラクターのID番号 にその船のIDが入っているキャラクター)を指揮官にする様にした。

◇具体的な変更点

@NPC_COMMANDER_ELECTION
非プレイヤー勢力の指揮官を決める為の関数です。
今はクエスト旗艦艦長を指揮官にする機能しかありません。

@BATTLE
@OTHER_GRID_ATTACK
プレイヤー勢力の場合に選択肢を表示する処理のELSEとして非プレイヤー勢力の場合には@NPC_COMMANDER_ELECTIONを呼び出す処理を追加しました。


◇備考
イベントの最中での戦闘であれば「イベント中の戦闘の前にキャラ生成・艦長化をしてから戦闘をして、戦闘後に続くイベントでクエスト旗艦フラグや艦長フラグを消す」などの後処理が可能ですし
クエストの旗艦艦隊のそれであれば「クエスト完了イベント時にクエスト旗艦フラグを消す」などである程度はなんとかなるかもしれませんが
後処理を挟まないまま「破壊されたクエスト旗艦の枠で生成された新規艦船」との戦闘になると艦長や旗艦フラグがそのままなので「同じキャラが・別の船で再度登場する」格好になります。
(クエスト旗艦撃沈からクエスト報告までの間に「クエスト旗艦が持つと想定される国籍を持った・同じIDを割り振られた別の船」が生成された場合にクエスト旗艦を撃沈していない扱いになる、というのとおおよそ同じ問題でしょうか)
現状においてはイベント中に戦闘を行う場合以外で非プレイヤー艦船にキャラクターを割り当てるのは余り推奨できる状態ではありません。

(仮に「撃沈された船を消す処理の際にその船のIDを持つクエスト旗艦フラグに手を加える」などの方法で対応するとすれば、「旗艦フラグから艦長のキャラIDを出す」方法が取れなくなるのでキャラクターの後処理に困ると思われます)