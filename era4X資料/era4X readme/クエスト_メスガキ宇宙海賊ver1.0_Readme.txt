クエスト：メスガキ宇宙海賊(ver.1.0)

◇概要
21年12月の4Xスレのメスガキ宇宙海賊話の前後と
(比較的恒常的に)戦闘でランダムキャラを得られる構造が欲しかったのと
気分的にも物語的にも後腐れなさそうな調教対象の供給源が欲しかったのとを
素人が全部混ぜた感じのクエストです。
つまり「メスガキ宇宙海賊を艦隊戦と白兵戦で分からせてから大人の恐ろしさを味わわせてやるぞグヘヘ」するのが目的の代物です。
(がっつりメスガキなあなただとか、"自称大人"のロリショタあなた辺りがメスガキ宇宙海賊を分からせに行ってもおいしそうですが、その辺りを考え出すと組み合わせ爆発とネタのカンブリア大爆発でエタりそうだったので意識的に手を付けてません)

(ここまで旧バージョン概要)

(ここから新バージョン概要)
旧バージョンに
「結局のところメスガキ宇宙海賊って何だよ」に対するアンサーと
遠隔攻撃や発射物/子機射出、交戦対象の確認を弄った意味と
その他色々とやりたい放題してみた感じの決戦編を追加したものです。
決戦編はメスガキはメスガキでも「メスガキ宇宙海賊って何だよ」に重点を置いているのでメスガキにeraeraするのにはあんまり向かないと思います。


◇物語
常識的に考えて聞こえて来るはずの無い「メスガキの宇宙海賊が居る」という噂を聞いたあなたは「メスガキ宇宙海賊が実在するのなら分からせてやろう」と怪しい宙域を調査する事にしました。

◇報酬
(通常)
敵艦撃破報酬 + 極少額のクレジット or ランダムキャラクター1人(最大2人から選択式。基本メスガキ・時々男の娘)

(決戦)
敵艦撃破報酬 + それなりのクレジット +　(ランダムキャラクター・特定艦船など)

◇備考
周回要素はありますが、周回時には敵の規模も雑にランダムなので返り討ちにあって分からせられない様にご注意ください。

クエスト「メスガキ宇宙海賊」ではありとあらゆるメスガキの宇宙海賊を「宇宙は広いしそんなメスガキも居たのかもね」の精神でゆるっと受け入れます。
言い換えると「メスガキ宇宙海賊の始祖」とかが出て来たとしてもそれは「どこぞのメスガキ宇宙海賊の始祖」に留まり、「それとは全く縁もゆかりも無いメスガキ宇宙海賊がゴロゴロしてて当然」みたいな方向性での受け入れになります。


◇履歴
2023/04/12
ver.1.0として決戦編を追加したものを配布開始。

2023/01/31
ver.0.15として(本体に取り込み済みの為)差分を配布
展開次第で(確保していない)メスガキ海賊をきちんと消せていなかったのを修正
(ランダムキャラはスキルを最初から持ってる事は無いみたいなのでゲーム的な意味はありませんが)キャプテンの生成タイミングを変えつつ旗艦に乗船させる事で非プレイヤー勢力指揮官設定パッチ適用下において指揮官に成れる様に


2023/01/02 (2)
ver.0.13として(本体に取り込み済みの為)差分を配布
キャラ生成の注意書きをより明瞭な形に変更
状態確認の為に変数を表示させてた処理を誤って残していたのを削除

2023/01/02 (1)
ver.0.12として(本体に取り込み済みの為)差分を配布
メスガキ宇宙海賊初プレイ時にメスガキ船員が範囲外のキャラ類型の場合があるのを修正
キャラIDを確保する前に他の関数を呼ぶ処理でRESULTが上書きされるのを修正

2023/01/01
ver.0.11として(本体に取り込み済みの為)差分を配布
余計な旗艦フラグ立てを消去・艦隊生成時の閾値判定を修正(プレイ上は特に差は無いと思われます)
クエストの表示タイトルの変化パターンを追加(2回目以降の場合に「続・」を追加)

2022/12/25
ver.0.1として配布開始



◇付録:作成した関数等の説明(覚書兼用)

クエスト本体の「QUEST_69_メスガキ宇宙海賊.ERB」から適時フォルダ「メスガキ宇宙海賊」内部の各ERBファイルの関数とかを呼んで処理してます。
フォルダ「メスガキ宇宙海賊」の中身は大体各ファイルの名前通りの目的の関数が入ってます。

QUEST_69_メスガキ宇宙海賊.ERB
	@MESUGAKI_PIRATES_INTRIDUCTION
クエスト本体(@QUEST_BODY_69)から呼び出される選択肢とその先の処理です。

	@MESUGAKI_TRAP_DECISION
名あり海賊を時々「メスガキのふりをした男の娘」であった事にする為の関数です。
キャラ類型を渡したらキャラ類型に応じた確率で「男の娘フラグが立った」事を示す為に1を、そうでなければ0を返します。


メスガキ宇宙海賊キャラ生成.ERB
	@MESUGAKI_PIRATES_CHARA_GENERATE
@CREATE_RANDOM_CHARAで作られたランダムキャラをキャラ類型に合わせて調整する関数です。
引数で指定する事で「特定の傾向を持ったキャラ」に限定できるランダムキャラ作成関数群とかを用意できればその方がよかったと思いますが、間に合わせに力業で何とかしようとした感じです。
キャラIDを返します。


メスガキ宇宙海賊艦隊生成.ERB
	@MESUGAKI_PIRATES_FLEET_GENERATE
メスガキ宇宙海賊の艦隊を作る為の関数です。
艦隊の傾向が決まってなかったら艦隊の規模(MESUGAKI_FLEET_SIZE)に合う感じの傾向を選んで・クエスト用の旗艦が決まってなかったら旗艦フラグ付きの船も作りつつ艦隊を作ります。
具体的な船の内容は@MESUGAKI_PIRATES_SHIP_TEMPLATEに投げてます。

	@MESUGAKI_PIRATES_SHIP_TEMPLATE
メスガキ宇宙海賊のテンプレ海賊船を作らせる為の関数です。
船のIDを返します。

	@MESUGAKI_PIRATES_FLEET_COST
船毎のコスト(独自値)を返す関数です。
@MESUGAKI_PIRATES_FLEET_GENERATEで作る艦隊をある種のコスト制で作らせる為の補助関数です。
(呼び出し元の艦隊生成関数共々厳密さは度外視しています。雑にそれっぽい質・数量になる様にしたかっただけです)


メスガキ宇宙海賊取得処理.ERB
	@MESUGAKI_CHOICE_BODY
捕まえたメスガキとかを取得する為の関数の本体です。
船員等の枠のキャラが白兵戦に参戦しないキャラ類型の場合にはここで生成させます。

	@MESUGAKI_CHOICE_INFO
キャラIDを入れたらステータス表示をする関数です。
クエスト・メスガキ宇宙海賊で欲しくて用意した関数だから「MESUGAKI」を冠していますが、正直な所メスガキ云々は関係ない関数です。
(ランダムキャラのステータス表示か何かから切り出してきたものに関数としての頭を付けたものだったと思います)

	@MESUGAKI_CHOICE_SUB
@MESUGAKI_CHOICE_BODYで選んだキャラを取得するかどうかの選択肢と取得処理をする関数です。


メスガキ宇宙海賊追撃.ERB
	@MESUGAKI_WAKARASE_FIGHT_OR_FLIGHT
捕縛目的の白兵戦イベントに進むかどうかの選択肢です。

	@MESUGAKI_WAKARASE_CLOSE_COMBAT
アノニム系のそれとかを利用させてもらいつつ、メスガキのランダムキャラとモブ船員を参加させて白兵戦を起こします。(メスガキのランダムキャラの参加が1人の場合には代わりとしてモブ副官を参戦させます)

メスガキ描写_(数字).ERB
	@MESUGAKI_PIRATES_(シーン種類)_(リーダーor船員)_(キャラ類型毎の数字)
メスガキ(+α)のキャラ類型毎に別の描写を挟む為の口上類似物です。


メスガキ宇宙海賊関数.ERB
そこそこ汎用性がありそうな関数からあまり再利用の効きそうにないものまで、一応は再利用の余地のありそうな関数を詰め込んであるファイルです。
(以下再利用が効きそうな関数をピックアップ)

	@ALL_SHIP_MEMBER_LIST
	@ONE_SHIP_MEMBER_LIST
乗船中のキャラをリストアップする為の関数です。

	@CC_DEFENDER_CONTINUED_COMBAT
	@CC_ATTACKER_CONTINUED_COMBAT
白兵戦で一方のリストだけをリセット・もう一方のリストのメンバーを戦闘不能でなければ待機状態にする事で「一方のメンバーを入れ替えつつ・もう一方のメンバーに連戦させる」為の関数です。

	@GET_CHARACTER_LIST
だいたいGET_SHIP_LIST系統の関数のキャラクター版です。

	@QUEST_RELEASE_SECTOR
特定セクター内のクエストフラグを消す関数です。
どのセクターにクエストフラグを立てたのかがわかっている時にしか使えませんが、処理量を減らす事ができます。

	@SERIAL_NUM_CHOICE_LOOPER
「0から連番になっている選択肢」に限ってですが、選択肢の数を渡す事で「範囲外の答えを弾いてループ」を委託出来る様にした関数です。

	@TYPING_LIKE_PRINTL
タイピングしてるみたいに一文字ずつ表示する関数です。
1文字を表示するのにかかる時間(ms)と揃える方向・文字列の桁数を設定する事ができます。

	@SET_DOCTRINE_FOR_POS
	@SET_DOCTRINE_FOR_LIST
ドクトリンの設定用関数です。
勢力・地点指定でリストを貰ってきてドクトリンIDと一緒にSET_DOCTRINE_FOR_LISTに投げる関数と
リストを受け取ってそのリストに載っている船にドクトリンIDを設定する関数です。


メスガキ決戦編_(決戦イベント番号).ERB
	@MESUGAKI_PIRATES_BASE_GENERATE_(決戦イベント番号)
	@MESUGAKI_PIRATES_BASE_REACH_PLACE_(決戦イベント番号)
	@MESUGAKI_PIRATES_BASE_EVENT_(決戦イベント番号)
	@MESUGAKI_PIRATES_NOT_BASE_EVENT_(決戦イベント番号)
	@MESUGAKI_PIRATES_BASE_MAP_INFO_(決戦イベント番号)
	@MESUGAKI_PIRATES_BASE_SHOW_COMMAND_(決戦イベント番号)
決戦イベント用に共通の命名規則で用意した関数群です。
追加の決戦イベントを用意する場合には既存の決戦イベントと連番にする必要がありますが
上記の関数群を適切に埋めて定数「メスガキ基地種類数」の数を増やせば、他の部分には特に手を付けずとも決戦イベントを追加する事が可能になっているはずです。


◇変更点(ver1.0)
・メスガキ宇宙海賊
決戦編を追加(大筋で3パターン・その他ランダム要素等あり)
事ある毎にクエスト旗艦IDを-1にする様に
戦闘直後にメスガキキャプテンの乗船情報を消す様に

・SLG_AI.ERB
建造物のミッションが「待機」に変わる条件に「ミッションに移動を伴うミッションが指定されている時」を追加(建造物に移動を伴わないミッションを実行させる為)

・AI_COUNTRY_10.ERB
@CHILD_DEVICE_DETAIL_10を追加(子機射出を実行可能にする為)

・SHIP_MODEL.ERH
新規艦船の宇宙にんげん(102)と小惑星基地(150)を追加

・SLG_INIT.ERB
プレイ開始時にPROJECTILE_DOCTRINEおよびBASE_DOCTRINEを読み込む処理を追加

・DOCTRINE.ERH
定数配列 PROJECTILE_DOCTRINE および BASE_DOCTRINE
定数 PROJECTILE_DOCTRINE_ID および BASE_DOCTRINE_ID を追加

・UPDATE.ERB
アップデート時用のドクトリンの追加処理を追加

・GameBase.csv
アップデート処理の為にバージョンを変更

PROJECTILE_DOCTRINE
発射物に用いる事を想定した無撤退ドクトリンです。
全主砲で最短の主砲の射程距離まで近づいて・大型艦に攻撃を行います。

BASE_DOCTRINE
建造物・基地の類に用いる事を想定したドクトリンです。
(回避を行えないのを前提に・高DPSではなく)高火力の、大型艦を優先して攻撃します。