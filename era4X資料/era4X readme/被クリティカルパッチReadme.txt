被クリティカル率パッチVer1

◇やりたい事
艦船および艦船装備およびオリジナル艦船に被クリティカル率(SHIP_CRITICAL_RISK/CRITICAL_RISK)を追加し、各種表示を可能とするパッチです。
戦闘に被クリティカル率が影響する様にしました。
表示の変動を見る為に被クリティカル率が変動する装備もいくつか同梱してあります。
(対応したスキルは同梱していませんが、内部的にはスキルによる補正も可能になっているはずです)

また艦船およびオリジナル艦船のステータスに特殊分類(SHIP_VARIANT)の項を設け、IS_VARIANT_(ID)を廃止しました。
(現状ではオリジナル艦船の特殊分類を変更する事はできません)

被クリティカル率は1000分率相当の値とするつもりで設定・表示しています
((実際にはGBAのFEよろしく実効クリティカル率的な何かですが)攻撃が命中した場合に、@GET_CRITICAL_RISKの返り値 >= 1000 なら 100%の確率で、同 == 500 なら 50%の確率で被クリティカルが発生する。)

@GET_CRITICAL_RISK
被クリティカル率の計算用関数です。
(被クリティカルの要因になる理屈が浮かばなかった)センサー以外を確認して最終的な被クリティカル率を返します。

艦船データ出力.ERB
このパッチでの変更点である「被クリティカル率およびステータス化した特殊分類」を見て返せる形式にしたものです。


おまけ
艦船データ出力_355→被クリティカル率ステータス化.ERB
4Xスレ5の>>355における形式の船のデータからこのパッチにおける形式の船のデータへと変換する際に使ったものです。
(実際には別のEmueraを入れて直接ERBファイルとして出力しましたが、本体に同梱されているEmueraで動く様に標準的な出力を行う様にしてあります)


◇備考
スレ5の>>355と同じ理由から艦船フォルダを削除してから適用してください。

既存のオリジナル船に被クリティカル率および特殊分類を追加する為にバージョンを2.0.11へと変更し、アップデート処理を行う様にしています。

デフォルト艦船の被クリティカル率は元々の被クリティカル率(RAND:250+RAND:250が素の回避率よりも大きくなる確率)と大雑把に近いはずの値としての「素の回避率/498」の確率(ステータスとしては1000分率なので×1000)にしています。

オリジナル艦船の被クリティカル率は
武装の数を増やす・回避率を上げる・HPを減らす(≒バイタルパートの割合が増える変更を行う)事で増加し
武装の数を減らす・回避率を下げる・HPを増やす(≒バイタルパートの割合が減る変更を行う)事で減少します。
変動値は完全に暫定的なものですし、本当はそれらとは別に固有の被クリティカル率増減も可能にできればよかったのですが優先度的な所で現状ではオミットされています。


◇更新履歴

2023/02/27
Ver1としてアップロード

2023/02/24
自作港の建造の後半と艦隊編成画面部分の修正のマージ

2023/02/23
戦闘にクリティカル率を追加するついでに
素の回避が0の時にRAND:0が出る問題の修正がてらに回避率を装備を考慮した値へ変更
対空判定を攻撃回数へ影響を及ぼすものへと変更
(ミサイル・魚雷は命中回数をMIN(攻撃命中数-(対空ダメージ/飛翔物HP), 0) 艦載機は命中回数×残存機数 へ)

2023/02/22
挙動確認の為に変更したままの定数があったので修正

2023/02/22
進捗報告版としてアップロード